"use strict";var Vo=Object.create;var ot=Object.defineProperty;var Yo=Object.getOwnPropertyDescriptor;var Qo=Object.getOwnPropertyNames;var Xo=Object.getPrototypeOf,Zo=Object.prototype.hasOwnProperty;var O=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),Jo=(s,e)=>{for(var t in e)ot(s,t,{get:e[t],enumerable:!0})},Bs=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Qo(e))!Zo.call(s,o)&&o!==t&&ot(s,o,{get:()=>e[o],enumerable:!(r=Yo(e,o))||r.enumerable});return s};var q=(s,e,t)=>(t=s!=null?Vo(Xo(s)):{},Bs(e||!s||!s.__esModule?ot(t,"default",{value:s,enumerable:!0}):t,s)),en=s=>Bs(ot({},"__esModule",{value:!0}),s);var Fe=O((_c,Ks)=>{"use strict";var sn=require("path"),ge="\\\\/",Us=`[^${ge}]`,we="\\.",rn="\\+",on="\\?",at="\\/",nn="(?=.)",Gs="[^/]",Ot=`(?:${at}|$)`,qs=`(?:^|${at})`,Nt=`${we}{1,2}${Ot}`,an=`(?!${we})`,cn=`(?!${qs}${Nt})`,ln=`(?!${we}{0,1}${Ot})`,dn=`(?!${Nt})`,un=`[^.${at}]`,pn=`${Gs}*?`,zs={DOT_LITERAL:we,PLUS_LITERAL:rn,QMARK_LITERAL:on,SLASH_LITERAL:at,ONE_CHAR:nn,QMARK:Gs,END_ANCHOR:Ot,DOTS_SLASH:Nt,NO_DOT:an,NO_DOTS:cn,NO_DOT_SLASH:ln,NO_DOTS_SLASH:dn,QMARK_NO_DOT:un,STAR:pn,START_ANCHOR:qs},hn={...zs,SLASH_LITERAL:`[${ge}]`,QMARK:Us,STAR:`${Us}*?`,DOTS_SLASH:`${we}{1,2}(?:[${ge}]|$)`,NO_DOT:`(?!${we})`,NO_DOTS:`(?!(?:^|[${ge}])${we}{1,2}(?:[${ge}]|$))`,NO_DOT_SLASH:`(?!${we}{0,1}(?:[${ge}]|$))`,NO_DOTS_SLASH:`(?!${we}{1,2}(?:[${ge}]|$))`,QMARK_NO_DOT:`[^.${ge}]`,START_ANCHOR:`(?:^|[${ge}])`,END_ANCHOR:`(?:[${ge}]|$)`},fn={alnum:"a-zA-Z0-9",alpha:"a-zA-Z",ascii:"\\x00-\\x7F",blank:" \\t",cntrl:"\\x00-\\x1F\\x7F",digit:"0-9",graph:"\\x21-\\x7E",lower:"a-z",print:"\\x20-\\x7E ",punct:"\\-!\"#$%&'()\\*+,./:;<=>?@[\\]^_`{|}~",space:" \\t\\r\\n\\v\\f",upper:"A-Z",word:"A-Za-z0-9_",xdigit:"A-Fa-f0-9"};Ks.exports={MAX_LENGTH:1024*64,POSIX_REGEX_SOURCE:fn,REGEX_BACKSLASH:/\\(?![*+?^${}(|)[\]])/g,REGEX_NON_SPECIAL_CHARS:/^[^@![\].,$*+?^{}()|\\/]+/,REGEX_SPECIAL_CHARS:/[-*+?.^${}(|)[\]]/,REGEX_SPECIAL_CHARS_BACKREF:/(\\?)((\W)(\3*))/g,REGEX_SPECIAL_CHARS_GLOBAL:/([-*+?.^${}(|)[\]])/g,REGEX_REMOVE_BACKSLASH:/(?:\[.*?[^\\]\]|\\(?=.))/g,REPLACEMENTS:{"***":"*","**/**":"**","**/**/**":"**"},CHAR_0:48,CHAR_9:57,CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_LEFT_PARENTHESES:40,CHAR_RIGHT_PARENTHESES:41,CHAR_ASTERISK:42,CHAR_AMPERSAND:38,CHAR_AT:64,CHAR_BACKWARD_SLASH:92,CHAR_CARRIAGE_RETURN:13,CHAR_CIRCUMFLEX_ACCENT:94,CHAR_COLON:58,CHAR_COMMA:44,CHAR_DOT:46,CHAR_DOUBLE_QUOTE:34,CHAR_EQUAL:61,CHAR_EXCLAMATION_MARK:33,CHAR_FORM_FEED:12,CHAR_FORWARD_SLASH:47,CHAR_GRAVE_ACCENT:96,CHAR_HASH:35,CHAR_HYPHEN_MINUS:45,CHAR_LEFT_ANGLE_BRACKET:60,CHAR_LEFT_CURLY_BRACE:123,CHAR_LEFT_SQUARE_BRACKET:91,CHAR_LINE_FEED:10,CHAR_NO_BREAK_SPACE:160,CHAR_PERCENT:37,CHAR_PLUS:43,CHAR_QUESTION_MARK:63,CHAR_RIGHT_ANGLE_BRACKET:62,CHAR_RIGHT_CURLY_BRACE:125,CHAR_RIGHT_SQUARE_BRACKET:93,CHAR_SEMICOLON:59,CHAR_SINGLE_QUOTE:39,CHAR_SPACE:32,CHAR_TAB:9,CHAR_UNDERSCORE:95,CHAR_VERTICAL_LINE:124,CHAR_ZERO_WIDTH_NOBREAK_SPACE:65279,SEP:sn.sep,extglobChars(s){return{"!":{type:"negate",open:"(?:(?!(?:",close:`))${s.STAR})`},"?":{type:"qmark",open:"(?:",close:")?"},"+":{type:"plus",open:"(?:",close:")+"},"*":{type:"star",open:"(?:",close:")*"},"@":{type:"at",open:"(?:",close:")"}}},globChars(s){return s===!0?hn:zs}}});var ct=O(re=>{"use strict";var gn=require("path"),mn=process.platform==="win32",{REGEX_BACKSLASH:wn,REGEX_REMOVE_BACKSLASH:vn,REGEX_SPECIAL_CHARS:yn,REGEX_SPECIAL_CHARS_GLOBAL:_n}=Fe();re.isObject=s=>s!==null&&typeof s=="object"&&!Array.isArray(s);re.hasRegexChars=s=>yn.test(s);re.isRegexChar=s=>s.length===1&&re.hasRegexChars(s);re.escapeRegex=s=>s.replace(_n,"\\$1");re.toPosixSlashes=s=>s.replace(wn,"/");re.removeBackslashes=s=>s.replace(vn,e=>e==="\\"?"":e);re.supportsLookbehinds=()=>{let s=process.version.slice(1).split(".").map(Number);return s.length===3&&s[0]>=9||s[0]===8&&s[1]>=10};re.isWindows=s=>s&&typeof s.windows=="boolean"?s.windows:mn===!0||gn.sep==="\\";re.escapeLast=(s,e,t)=>{let r=s.lastIndexOf(e,t);return r===-1?s:s[r-1]==="\\"?re.escapeLast(s,e,r-1):`${s.slice(0,r)}\\${s.slice(r)}`};re.removePrefix=(s,e={})=>{let t=s;return t.startsWith("./")&&(t=t.slice(2),e.prefix="./"),t};re.wrapOutput=(s,e={},t={})=>{let r=t.contains?"":"^",o=t.contains?"":"$",i=`${r}(?:${s})${o}`;return e.negated===!0&&(i=`(?:^(?!${i}).*$)`),i}});var tr=O((kc,er)=>{"use strict";var Vs=ct(),{CHAR_ASTERISK:Bt,CHAR_AT:bn,CHAR_BACKWARD_SLASH:Le,CHAR_COMMA:kn,CHAR_DOT:jt,CHAR_EXCLAMATION_MARK:Wt,CHAR_FORWARD_SLASH:Js,CHAR_LEFT_CURLY_BRACE:Ut,CHAR_LEFT_PARENTHESES:Gt,CHAR_LEFT_SQUARE_BRACKET:Rn,CHAR_PLUS:Cn,CHAR_QUESTION_MARK:Ys,CHAR_RIGHT_CURLY_BRACE:En,CHAR_RIGHT_PARENTHESES:Qs,CHAR_RIGHT_SQUARE_BRACKET:xn}=Fe(),Xs=s=>s===Js||s===Le,Zs=s=>{s.isPrefix!==!0&&(s.depth=s.isGlobstar?1/0:1)},Sn=(s,e)=>{let t=e||{},r=s.length-1,o=t.parts===!0||t.scanToEnd===!0,i=[],n=[],a=[],c=s,u=-1,d=0,p=0,l=!1,f=!1,v=!1,y=!1,R=!1,P=!1,S=!1,E=!1,F=!1,T=!1,C=0,D,b,A={value:"",depth:0,isGlob:!1},j=()=>u>=r,w=()=>c.charCodeAt(u+1),$=()=>(D=b,c.charCodeAt(++u));for(;u<r;){b=$();let te;if(b===Le){S=A.backslashes=!0,b=$(),b===Ut&&(P=!0);continue}if(P===!0||b===Ut){for(C++;j()!==!0&&(b=$());){if(b===Le){S=A.backslashes=!0,$();continue}if(b===Ut){C++;continue}if(P!==!0&&b===jt&&(b=$())===jt){if(l=A.isBrace=!0,v=A.isGlob=!0,T=!0,o===!0)continue;break}if(P!==!0&&b===kn){if(l=A.isBrace=!0,v=A.isGlob=!0,T=!0,o===!0)continue;break}if(b===En&&(C--,C===0)){P=!1,l=A.isBrace=!0,T=!0;break}}if(o===!0)continue;break}if(b===Js){if(i.push(u),n.push(A),A={value:"",depth:0,isGlob:!1},T===!0)continue;if(D===jt&&u===d+1){d+=2;continue}p=u+1;continue}if(t.noext!==!0&&(b===Cn||b===bn||b===Bt||b===Ys||b===Wt)===!0&&w()===Gt){if(v=A.isGlob=!0,y=A.isExtglob=!0,T=!0,b===Wt&&u===d&&(F=!0),o===!0){for(;j()!==!0&&(b=$());){if(b===Le){S=A.backslashes=!0,b=$();continue}if(b===Qs){v=A.isGlob=!0,T=!0;break}}continue}break}if(b===Bt){if(D===Bt&&(R=A.isGlobstar=!0),v=A.isGlob=!0,T=!0,o===!0)continue;break}if(b===Ys){if(v=A.isGlob=!0,T=!0,o===!0)continue;break}if(b===Rn){for(;j()!==!0&&(te=$());){if(te===Le){S=A.backslashes=!0,$();continue}if(te===xn){f=A.isBracket=!0,v=A.isGlob=!0,T=!0;break}}if(o===!0)continue;break}if(t.nonegate!==!0&&b===Wt&&u===d){E=A.negated=!0,d++;continue}if(t.noparen!==!0&&b===Gt){if(v=A.isGlob=!0,o===!0){for(;j()!==!0&&(b=$());){if(b===Gt){S=A.backslashes=!0,b=$();continue}if(b===Qs){T=!0;break}}continue}break}if(v===!0){if(T=!0,o===!0)continue;break}}t.noext===!0&&(y=!1,v=!1);let L=c,oe="",g="";d>0&&(oe=c.slice(0,d),c=c.slice(d),p-=d),L&&v===!0&&p>0?(L=c.slice(0,p),g=c.slice(p)):v===!0?(L="",g=c):L=c,L&&L!==""&&L!=="/"&&L!==c&&Xs(L.charCodeAt(L.length-1))&&(L=L.slice(0,-1)),t.unescape===!0&&(g&&(g=Vs.removeBackslashes(g)),L&&S===!0&&(L=Vs.removeBackslashes(L)));let m={prefix:oe,input:s,start:d,base:L,glob:g,isBrace:l,isBracket:f,isGlob:v,isExtglob:y,isGlobstar:R,negated:E,negatedExtglob:F};if(t.tokens===!0&&(m.maxDepth=0,Xs(b)||n.push(A),m.tokens=n),t.parts===!0||t.tokens===!0){let te;for(let H=0;H<i.length;H++){let he=te?te+1:d,fe=i[H],ne=s.slice(he,fe);t.tokens&&(H===0&&d!==0?(n[H].isPrefix=!0,n[H].value=oe):n[H].value=ne,Zs(n[H]),m.maxDepth+=n[H].depth),(H!==0||ne!=="")&&a.push(ne),te=fe}if(te&&te+1<s.length){let H=s.slice(te+1);a.push(H),t.tokens&&(n[n.length-1].value=H,Zs(n[n.length-1]),m.maxDepth+=n[n.length-1].depth)}m.slashes=i,m.parts=a}return m};er.exports=Sn});var or=O((Rc,rr)=>{"use strict";var lt=Fe(),ie=ct(),{MAX_LENGTH:dt,POSIX_REGEX_SOURCE:Pn,REGEX_NON_SPECIAL_CHARS:An,REGEX_SPECIAL_CHARS_BACKREF:Tn,REPLACEMENTS:sr}=lt,In=(s,e)=>{if(typeof e.expandRange=="function")return e.expandRange(...s,e);s.sort();let t=`[${s.join("-")}]`;try{new RegExp(t)}catch{return s.map(o=>ie.escapeRegex(o)).join("..")}return t},xe=(s,e)=>`Missing ${s}: "${e}" - use "\\\\${e}" to match literal characters`,qt=(s,e)=>{if(typeof s!="string")throw new TypeError("Expected a string");s=sr[s]||s;let t={...e},r=typeof t.maxLength=="number"?Math.min(dt,t.maxLength):dt,o=s.length;if(o>r)throw new SyntaxError(`Input length: ${o}, exceeds maximum allowed length: ${r}`);let i={type:"bos",value:"",output:t.prepend||""},n=[i],a=t.capture?"":"?:",c=ie.isWindows(e),u=lt.globChars(c),d=lt.extglobChars(u),{DOT_LITERAL:p,PLUS_LITERAL:l,SLASH_LITERAL:f,ONE_CHAR:v,DOTS_SLASH:y,NO_DOT:R,NO_DOT_SLASH:P,NO_DOTS_SLASH:S,QMARK:E,QMARK_NO_DOT:F,STAR:T,START_ANCHOR:C}=u,D=k=>`(${a}(?:(?!${C}${k.dot?y:p}).)*?)`,b=t.dot?"":R,A=t.dot?E:F,j=t.bash===!0?D(t):T;t.capture&&(j=`(${j})`),typeof t.noext=="boolean"&&(t.noextglob=t.noext);let w={input:s,index:-1,start:0,dot:t.dot===!0,consumed:"",output:"",prefix:"",backtrack:!1,negated:!1,brackets:0,braces:0,parens:0,quotes:0,globstar:!1,tokens:n};s=ie.removePrefix(s,w),o=s.length;let $=[],L=[],oe=[],g=i,m,te=()=>w.index===o-1,H=w.peek=(k=1)=>s[w.index+k],he=w.advance=()=>s[++w.index]||"",fe=()=>s.slice(w.index+1),ne=(k="",W=0)=>{w.consumed+=k,w.index+=W},et=k=>{w.output+=k.output!=null?k.output:k.value,ne(k.value)},zo=()=>{let k=1;for(;H()==="!"&&(H(2)!=="("||H(3)==="?");)he(),w.start++,k++;return k%2===0?!1:(w.negated=!0,w.start++,!0)},tt=k=>{w[k]++,oe.push(k)},ye=k=>{w[k]--,oe.pop()},M=k=>{if(g.type==="globstar"){let W=w.braces>0&&(k.type==="comma"||k.type==="brace"),_=k.extglob===!0||$.length&&(k.type==="pipe"||k.type==="paren");k.type!=="slash"&&k.type!=="paren"&&!W&&!_&&(w.output=w.output.slice(0,-g.output.length),g.type="star",g.value="*",g.output=j,w.output+=g.output)}if($.length&&k.type!=="paren"&&($[$.length-1].inner+=k.value),(k.value||k.output)&&et(k),g&&g.type==="text"&&k.type==="text"){g.value+=k.value,g.output=(g.output||"")+k.value;return}k.prev=g,n.push(k),g=k},st=(k,W)=>{let _={...d[W],conditions:1,inner:""};_.prev=g,_.parens=w.parens,_.output=w.output;let I=(t.capture?"(":"")+_.open;tt("parens"),M({type:k,value:W,output:w.output?"":v}),M({type:"paren",extglob:!0,value:he(),output:I}),$.push(_)},Ko=k=>{let W=k.close+(t.capture?")":""),_;if(k.type==="negate"){let I=j;if(k.inner&&k.inner.length>1&&k.inner.includes("/")&&(I=D(t)),(I!==j||te()||/^\)+$/.test(fe()))&&(W=k.close=`)$))${I}`),k.inner.includes("*")&&(_=fe())&&/^\.[^\\/.]+$/.test(_)){let G=qt(_,{...e,fastpaths:!1}).output;W=k.close=`)${G})${I})`}k.prev.type==="bos"&&(w.negatedExtglob=!0)}M({type:"paren",extglob:!0,value:m,output:W}),ye("parens")};if(t.fastpaths!==!1&&!/(^[*!]|[/()[\]{}"])/.test(s)){let k=!1,W=s.replace(Tn,(_,I,G,se,V,Ht)=>se==="\\"?(k=!0,_):se==="?"?I?I+se+(V?E.repeat(V.length):""):Ht===0?A+(V?E.repeat(V.length):""):E.repeat(G.length):se==="."?p.repeat(G.length):se==="*"?I?I+se+(V?j:""):j:I?_:`\\${_}`);return k===!0&&(t.unescape===!0?W=W.replace(/\\/g,""):W=W.replace(/\\+/g,_=>_.length%2===0?"\\\\":_?"\\":"")),W===s&&t.contains===!0?(w.output=s,w):(w.output=ie.wrapOutput(W,w,e),w)}for(;!te();){if(m=he(),m==="\0")continue;if(m==="\\"){let _=H();if(_==="/"&&t.bash!==!0||_==="."||_===";")continue;if(!_){m+="\\",M({type:"text",value:m});continue}let I=/^\\+/.exec(fe()),G=0;if(I&&I[0].length>2&&(G=I[0].length,w.index+=G,G%2!==0&&(m+="\\")),t.unescape===!0?m=he():m+=he(),w.brackets===0){M({type:"text",value:m});continue}}if(w.brackets>0&&(m!=="]"||g.value==="["||g.value==="[^")){if(t.posix!==!1&&m===":"){let _=g.value.slice(1);if(_.includes("[")&&(g.posix=!0,_.includes(":"))){let I=g.value.lastIndexOf("["),G=g.value.slice(0,I),se=g.value.slice(I+2),V=Pn[se];if(V){g.value=G+V,w.backtrack=!0,he(),!i.output&&n.indexOf(g)===1&&(i.output=v);continue}}}(m==="["&&H()!==":"||m==="-"&&H()==="]")&&(m=`\\${m}`),m==="]"&&(g.value==="["||g.value==="[^")&&(m=`\\${m}`),t.posix===!0&&m==="!"&&g.value==="["&&(m="^"),g.value+=m,et({value:m});continue}if(w.quotes===1&&m!=='"'){m=ie.escapeRegex(m),g.value+=m,et({value:m});continue}if(m==='"'){w.quotes=w.quotes===1?0:1,t.keepQuotes===!0&&M({type:"text",value:m});continue}if(m==="("){tt("parens"),M({type:"paren",value:m});continue}if(m===")"){if(w.parens===0&&t.strictBrackets===!0)throw new SyntaxError(xe("opening","("));let _=$[$.length-1];if(_&&w.parens===_.parens+1){Ko($.pop());continue}M({type:"paren",value:m,output:w.parens?")":"\\)"}),ye("parens");continue}if(m==="["){if(t.nobracket===!0||!fe().includes("]")){if(t.nobracket!==!0&&t.strictBrackets===!0)throw new SyntaxError(xe("closing","]"));m=`\\${m}`}else tt("brackets");M({type:"bracket",value:m});continue}if(m==="]"){if(t.nobracket===!0||g&&g.type==="bracket"&&g.value.length===1){M({type:"text",value:m,output:`\\${m}`});continue}if(w.brackets===0){if(t.strictBrackets===!0)throw new SyntaxError(xe("opening","["));M({type:"text",value:m,output:`\\${m}`});continue}ye("brackets");let _=g.value.slice(1);if(g.posix!==!0&&_[0]==="^"&&!_.includes("/")&&(m=`/${m}`),g.value+=m,et({value:m}),t.literalBrackets===!1||ie.hasRegexChars(_))continue;let I=ie.escapeRegex(g.value);if(w.output=w.output.slice(0,-g.value.length),t.literalBrackets===!0){w.output+=I,g.value=I;continue}g.value=`(${a}${I}|${g.value})`,w.output+=g.value;continue}if(m==="{"&&t.nobrace!==!0){tt("braces");let _={type:"brace",value:m,output:"(",outputIndex:w.output.length,tokensIndex:w.tokens.length};L.push(_),M(_);continue}if(m==="}"){let _=L[L.length-1];if(t.nobrace===!0||!_){M({type:"text",value:m,output:m});continue}let I=")";if(_.dots===!0){let G=n.slice(),se=[];for(let V=G.length-1;V>=0&&(n.pop(),G[V].type!=="brace");V--)G[V].type!=="dots"&&se.unshift(G[V].value);I=In(se,t),w.backtrack=!0}if(_.comma!==!0&&_.dots!==!0){let G=w.output.slice(0,_.outputIndex),se=w.tokens.slice(_.tokensIndex);_.value=_.output="\\{",m=I="\\}",w.output=G;for(let V of se)w.output+=V.output||V.value}M({type:"brace",value:m,output:I}),ye("braces"),L.pop();continue}if(m==="|"){$.length>0&&$[$.length-1].conditions++,M({type:"text",value:m});continue}if(m===","){let _=m,I=L[L.length-1];I&&oe[oe.length-1]==="braces"&&(I.comma=!0,_="|"),M({type:"comma",value:m,output:_});continue}if(m==="/"){if(g.type==="dot"&&w.index===w.start+1){w.start=w.index+1,w.consumed="",w.output="",n.pop(),g=i;continue}M({type:"slash",value:m,output:f});continue}if(m==="."){if(w.braces>0&&g.type==="dot"){g.value==="."&&(g.output=p);let _=L[L.length-1];g.type="dots",g.output+=m,g.value+=m,_.dots=!0;continue}if(w.braces+w.parens===0&&g.type!=="bos"&&g.type!=="slash"){M({type:"text",value:m,output:p});continue}M({type:"dot",value:m,output:p});continue}if(m==="?"){if(!(g&&g.value==="(")&&t.noextglob!==!0&&H()==="("&&H(2)!=="?"){st("qmark",m);continue}if(g&&g.type==="paren"){let I=H(),G=m;if(I==="<"&&!ie.supportsLookbehinds())throw new Error("Node.js v10 or higher is required for regex lookbehinds");(g.value==="("&&!/[!=<:]/.test(I)||I==="<"&&!/<([!=]|\w+>)/.test(fe()))&&(G=`\\${m}`),M({type:"text",value:m,output:G});continue}if(t.dot!==!0&&(g.type==="slash"||g.type==="bos")){M({type:"qmark",value:m,output:F});continue}M({type:"qmark",value:m,output:E});continue}if(m==="!"){if(t.noextglob!==!0&&H()==="("&&(H(2)!=="?"||!/[!=<:]/.test(H(3)))){st("negate",m);continue}if(t.nonegate!==!0&&w.index===0){zo();continue}}if(m==="+"){if(t.noextglob!==!0&&H()==="("&&H(2)!=="?"){st("plus",m);continue}if(g&&g.value==="("||t.regex===!1){M({type:"plus",value:m,output:l});continue}if(g&&(g.type==="bracket"||g.type==="paren"||g.type==="brace")||w.parens>0){M({type:"plus",value:m});continue}M({type:"plus",value:l});continue}if(m==="@"){if(t.noextglob!==!0&&H()==="("&&H(2)!=="?"){M({type:"at",extglob:!0,value:m,output:""});continue}M({type:"text",value:m});continue}if(m!=="*"){(m==="$"||m==="^")&&(m=`\\${m}`);let _=An.exec(fe());_&&(m+=_[0],w.index+=_[0].length),M({type:"text",value:m});continue}if(g&&(g.type==="globstar"||g.star===!0)){g.type="star",g.star=!0,g.value+=m,g.output=j,w.backtrack=!0,w.globstar=!0,ne(m);continue}let k=fe();if(t.noextglob!==!0&&/^\([^?]/.test(k)){st("star",m);continue}if(g.type==="star"){if(t.noglobstar===!0){ne(m);continue}let _=g.prev,I=_.prev,G=_.type==="slash"||_.type==="bos",se=I&&(I.type==="star"||I.type==="globstar");if(t.bash===!0&&(!G||k[0]&&k[0]!=="/")){M({type:"star",value:m,output:""});continue}let V=w.braces>0&&(_.type==="comma"||_.type==="brace"),Ht=$.length&&(_.type==="pipe"||_.type==="paren");if(!G&&_.type!=="paren"&&!V&&!Ht){M({type:"star",value:m,output:""});continue}for(;k.slice(0,3)==="/**";){let rt=s[w.index+4];if(rt&&rt!=="/")break;k=k.slice(3),ne("/**",3)}if(_.type==="bos"&&te()){g.type="globstar",g.value+=m,g.output=D(t),w.output=g.output,w.globstar=!0,ne(m);continue}if(_.type==="slash"&&_.prev.type!=="bos"&&!se&&te()){w.output=w.output.slice(0,-(_.output+g.output).length),_.output=`(?:${_.output}`,g.type="globstar",g.output=D(t)+(t.strictSlashes?")":"|$)"),g.value+=m,w.globstar=!0,w.output+=_.output+g.output,ne(m);continue}if(_.type==="slash"&&_.prev.type!=="bos"&&k[0]==="/"){let rt=k[1]!==void 0?"|$":"";w.output=w.output.slice(0,-(_.output+g.output).length),_.output=`(?:${_.output}`,g.type="globstar",g.output=`${D(t)}${f}|${f}${rt})`,g.value+=m,w.output+=_.output+g.output,w.globstar=!0,ne(m+he()),M({type:"slash",value:"/",output:""});continue}if(_.type==="bos"&&k[0]==="/"){g.type="globstar",g.value+=m,g.output=`(?:^|${f}|${D(t)}${f})`,w.output=g.output,w.globstar=!0,ne(m+he()),M({type:"slash",value:"/",output:""});continue}w.output=w.output.slice(0,-g.output.length),g.type="globstar",g.output=D(t),g.value+=m,w.output+=g.output,w.globstar=!0,ne(m);continue}let W={type:"star",value:m,output:j};if(t.bash===!0){W.output=".*?",(g.type==="bos"||g.type==="slash")&&(W.output=b+W.output),M(W);continue}if(g&&(g.type==="bracket"||g.type==="paren")&&t.regex===!0){W.output=m,M(W);continue}(w.index===w.start||g.type==="slash"||g.type==="dot")&&(g.type==="dot"?(w.output+=P,g.output+=P):t.dot===!0?(w.output+=S,g.output+=S):(w.output+=b,g.output+=b),H()!=="*"&&(w.output+=v,g.output+=v)),M(W)}for(;w.brackets>0;){if(t.strictBrackets===!0)throw new SyntaxError(xe("closing","]"));w.output=ie.escapeLast(w.output,"["),ye("brackets")}for(;w.parens>0;){if(t.strictBrackets===!0)throw new SyntaxError(xe("closing",")"));w.output=ie.escapeLast(w.output,"("),ye("parens")}for(;w.braces>0;){if(t.strictBrackets===!0)throw new SyntaxError(xe("closing","}"));w.output=ie.escapeLast(w.output,"{"),ye("braces")}if(t.strictSlashes!==!0&&(g.type==="star"||g.type==="bracket")&&M({type:"maybe_slash",value:"",output:`${f}?`}),w.backtrack===!0){w.output="";for(let k of w.tokens)w.output+=k.output!=null?k.output:k.value,k.suffix&&(w.output+=k.suffix)}return w};qt.fastpaths=(s,e)=>{let t={...e},r=typeof t.maxLength=="number"?Math.min(dt,t.maxLength):dt,o=s.length;if(o>r)throw new SyntaxError(`Input length: ${o}, exceeds maximum allowed length: ${r}`);s=sr[s]||s;let i=ie.isWindows(e),{DOT_LITERAL:n,SLASH_LITERAL:a,ONE_CHAR:c,DOTS_SLASH:u,NO_DOT:d,NO_DOTS:p,NO_DOTS_SLASH:l,STAR:f,START_ANCHOR:v}=lt.globChars(i),y=t.dot?p:d,R=t.dot?l:d,P=t.capture?"":"?:",S={negated:!1,prefix:""},E=t.bash===!0?".*?":f;t.capture&&(E=`(${E})`);let F=b=>b.noglobstar===!0?E:`(${P}(?:(?!${v}${b.dot?u:n}).)*?)`,T=b=>{switch(b){case"*":return`${y}${c}${E}`;case".*":return`${n}${c}${E}`;case"*.*":return`${y}${E}${n}${c}${E}`;case"*/*":return`${y}${E}${a}${c}${R}${E}`;case"**":return y+F(t);case"**/*":return`(?:${y}${F(t)}${a})?${R}${c}${E}`;case"**/*.*":return`(?:${y}${F(t)}${a})?${R}${E}${n}${c}${E}`;case"**/.*":return`(?:${y}${F(t)}${a})?${n}${c}${E}`;default:{let A=/^(.*?)\.(\w+)$/.exec(b);if(!A)return;let j=T(A[1]);return j?j+n+A[2]:void 0}}},C=ie.removePrefix(s,S),D=T(C);return D&&t.strictSlashes!==!0&&(D+=`${a}?`),D};rr.exports=qt});var ir=O((Cc,nr)=>{"use strict";var $n=require("path"),Mn=tr(),zt=or(),Kt=ct(),Dn=Fe(),Fn=s=>s&&typeof s=="object"&&!Array.isArray(s),K=(s,e,t=!1)=>{if(Array.isArray(s)){let d=s.map(l=>K(l,e,t));return l=>{for(let f of d){let v=f(l);if(v)return v}return!1}}let r=Fn(s)&&s.tokens&&s.input;if(s===""||typeof s!="string"&&!r)throw new TypeError("Expected pattern to be a non-empty string");let o=e||{},i=Kt.isWindows(e),n=r?K.compileRe(s,e):K.makeRe(s,e,!1,!0),a=n.state;delete n.state;let c=()=>!1;if(o.ignore){let d={...e,ignore:null,onMatch:null,onResult:null};c=K(o.ignore,d,t)}let u=(d,p=!1)=>{let{isMatch:l,match:f,output:v}=K.test(d,n,e,{glob:s,posix:i}),y={glob:s,state:a,regex:n,posix:i,input:d,output:v,match:f,isMatch:l};return typeof o.onResult=="function"&&o.onResult(y),l===!1?(y.isMatch=!1,p?y:!1):c(d)?(typeof o.onIgnore=="function"&&o.onIgnore(y),y.isMatch=!1,p?y:!1):(typeof o.onMatch=="function"&&o.onMatch(y),p?y:!0)};return t&&(u.state=a),u};K.test=(s,e,t,{glob:r,posix:o}={})=>{if(typeof s!="string")throw new TypeError("Expected input to be a string");if(s==="")return{isMatch:!1,output:""};let i=t||{},n=i.format||(o?Kt.toPosixSlashes:null),a=s===r,c=a&&n?n(s):s;return a===!1&&(c=n?n(s):s,a=c===r),(a===!1||i.capture===!0)&&(i.matchBase===!0||i.basename===!0?a=K.matchBase(s,e,t,o):a=e.exec(c)),{isMatch:!!a,match:a,output:c}};K.matchBase=(s,e,t,r=Kt.isWindows(t))=>(e instanceof RegExp?e:K.makeRe(e,t)).test($n.basename(s));K.isMatch=(s,e,t)=>K(e,t)(s);K.parse=(s,e)=>Array.isArray(s)?s.map(t=>K.parse(t,e)):zt(s,{...e,fastpaths:!1});K.scan=(s,e)=>Mn(s,e);K.compileRe=(s,e,t=!1,r=!1)=>{if(t===!0)return s.output;let o=e||{},i=o.contains?"":"^",n=o.contains?"":"$",a=`${i}(?:${s.output})${n}`;s&&s.negated===!0&&(a=`^(?!${a}).*$`);let c=K.toRegex(a,e);return r===!0&&(c.state=s),c};K.makeRe=(s,e={},t=!1,r=!1)=>{if(!s||typeof s!="string")throw new TypeError("Expected a non-empty string");let o={negated:!1,fastpaths:!0};return e.fastpaths!==!1&&(s[0]==="."||s[0]==="*")&&(o.output=zt.fastpaths(s,e)),o.output||(o=zt(s,e)),K.compileRe(o,e,t,r)};K.toRegex=(s,e)=>{try{let t=e||{};return new RegExp(s,t.flags||(t.nocase?"i":""))}catch(t){if(e&&e.debug===!0)throw t;return/$^/}};K.constants=Dn;nr.exports=K});var Vt=O((Ec,ar)=>{"use strict";ar.exports=ir()});var gr=O((xc,fr)=>{"use strict";var Oe=require("fs"),{Readable:Ln}=require("stream"),He=require("path"),{promisify:ft}=require("util"),Yt=Vt(),Hn=ft(Oe.readdir),On=ft(Oe.stat),cr=ft(Oe.lstat),Nn=ft(Oe.realpath),Bn="!",pr="READDIRP_RECURSIVE_ERROR",jn=new Set(["ENOENT","EPERM","EACCES","ELOOP",pr]),Qt="files",hr="directories",pt="files_directories",ut="all",lr=[Qt,hr,pt,ut],Wn=s=>jn.has(s.code),[dr,Un]=process.versions.node.split(".").slice(0,2).map(s=>Number.parseInt(s,10)),Gn=process.platform==="win32"&&(dr>10||dr===10&&Un>=5),ur=s=>{if(s!==void 0){if(typeof s=="function")return s;if(typeof s=="string"){let e=Yt(s.trim());return t=>e(t.basename)}if(Array.isArray(s)){let e=[],t=[];for(let r of s){let o=r.trim();o.charAt(0)===Bn?t.push(Yt(o.slice(1))):e.push(Yt(o))}return t.length>0?e.length>0?r=>e.some(o=>o(r.basename))&&!t.some(o=>o(r.basename)):r=>!t.some(o=>o(r.basename)):r=>e.some(o=>o(r.basename))}}},ht=class s extends Ln{static get defaultOptions(){return{root:".",fileFilter:e=>!0,directoryFilter:e=>!0,type:Qt,lstat:!1,depth:2147483648,alwaysStat:!1}}constructor(e={}){super({objectMode:!0,autoDestroy:!0,highWaterMark:e.highWaterMark||4096});let t={...s.defaultOptions,...e},{root:r,type:o}=t;this._fileFilter=ur(t.fileFilter),this._directoryFilter=ur(t.directoryFilter);let i=t.lstat?cr:On;Gn?this._stat=n=>i(n,{bigint:!0}):this._stat=i,this._maxDepth=t.depth,this._wantsDir=[hr,pt,ut].includes(o),this._wantsFile=[Qt,pt,ut].includes(o),this._wantsEverything=o===ut,this._root=He.resolve(r),this._isDirent="Dirent"in Oe&&!t.alwaysStat,this._statsProp=this._isDirent?"dirent":"stats",this._rdOptions={encoding:"utf8",withFileTypes:this._isDirent},this.parents=[this._exploreDir(r,1)],this.reading=!1,this.parent=void 0}async _read(e){if(!this.reading){this.reading=!0;try{for(;!this.destroyed&&e>0;){let{path:t,depth:r,files:o=[]}=this.parent||{};if(o.length>0){let i=o.splice(0,e).map(n=>this._formatEntry(n,t));for(let n of await Promise.all(i)){if(this.destroyed)return;let a=await this._getEntryType(n);a==="directory"&&this._directoryFilter(n)?(r<=this._maxDepth&&this.parents.push(this._exploreDir(n.fullPath,r+1)),this._wantsDir&&(this.push(n),e--)):(a==="file"||this._includeAsFile(n))&&this._fileFilter(n)&&this._wantsFile&&(this.push(n),e--)}}else{let i=this.parents.pop();if(!i){this.push(null);break}if(this.parent=await i,this.destroyed)return}}}catch(t){this.destroy(t)}finally{this.reading=!1}}}async _exploreDir(e,t){let r;try{r=await Hn(e,this._rdOptions)}catch(o){this._onError(o)}return{files:r,depth:t,path:e}}async _formatEntry(e,t){let r;try{let o=this._isDirent?e.name:e,i=He.resolve(He.join(t,o));r={path:He.relative(this._root,i),fullPath:i,basename:o},r[this._statsProp]=this._isDirent?e:await this._stat(i)}catch(o){this._onError(o)}return r}_onError(e){Wn(e)&&!this.destroyed?this.emit("warn",e):this.destroy(e)}async _getEntryType(e){let t=e&&e[this._statsProp];if(t){if(t.isFile())return"file";if(t.isDirectory())return"directory";if(t&&t.isSymbolicLink()){let r=e.fullPath;try{let o=await Nn(r),i=await cr(o);if(i.isFile())return"file";if(i.isDirectory()){let n=o.length;if(r.startsWith(o)&&r.substr(n,1)===He.sep){let a=new Error(`Circular symlink detected: "${r}" points to "${o}"`);return a.code=pr,this._onError(a)}return"directory"}}catch(o){this._onError(o)}}}}_includeAsFile(e){let t=e&&e[this._statsProp];return t&&this._wantsEverything&&!t.isDirectory()}},Se=(s,e={})=>{let t=e.entryType||e.type;if(t==="both"&&(t=pt),t&&(e.type=t),s){if(typeof s!="string")throw new TypeError("readdirp: root argument must be a string. Usage: readdirp(root, options)");if(t&&!lr.includes(t))throw new Error(`readdirp: Invalid type passed. Use one of ${lr.join(", ")}`)}else throw new Error("readdirp: root argument is required. Usage: readdirp(root, options)");return e.root=s,new ht(e)},qn=(s,e={})=>new Promise((t,r)=>{let o=[];Se(s,e).on("data",i=>o.push(i)).on("end",()=>t(o)).on("error",i=>r(i))});Se.promise=qn;Se.ReaddirpStream=ht;Se.default=Se;fr.exports=Se});var Xt=O((Sc,mr)=>{mr.exports=function(s,e){if(typeof s!="string")throw new TypeError("expected path to be a string");if(s==="\\"||s==="/")return"/";var t=s.length;if(t<=1)return s;var r="";if(t>4&&s[3]==="\\"){var o=s[2];(o==="?"||o===".")&&s.slice(0,2)==="\\\\"&&(s=s.slice(2),r="//")}var i=s.split(/[/\\]+/);return e!==!1&&i[i.length-1]===""&&i.pop(),r+i.join("/")}});var kr=O((_r,br)=>{"use strict";Object.defineProperty(_r,"__esModule",{value:!0});var yr=Vt(),zn=Xt(),wr="!",Kn={returnIndex:!1},Vn=s=>Array.isArray(s)?s:[s],Yn=(s,e)=>{if(typeof s=="function")return s;if(typeof s=="string"){let t=yr(s,e);return r=>s===r||t(r)}return s instanceof RegExp?t=>s.test(t):t=>!1},vr=(s,e,t,r)=>{let o=Array.isArray(t),i=o?t[0]:t;if(!o&&typeof i!="string")throw new TypeError("anymatch: second argument must be a string: got "+Object.prototype.toString.call(i));let n=zn(i,!1);for(let c=0;c<e.length;c++){let u=e[c];if(u(n))return r?-1:!1}let a=o&&[n].concat(t.slice(1));for(let c=0;c<s.length;c++){let u=s[c];if(o?u(...a):u(n))return r?c:!0}return r?-1:!1},Zt=(s,e,t=Kn)=>{if(s==null)throw new TypeError("anymatch: specify first argument");let r=typeof t=="boolean"?{returnIndex:t}:t,o=r.returnIndex||!1,i=Vn(s),n=i.filter(c=>typeof c=="string"&&c.charAt(0)===wr).map(c=>c.slice(1)).map(c=>yr(c,r)),a=i.filter(c=>typeof c!="string"||typeof c=="string"&&c.charAt(0)!==wr).map(c=>Yn(c,r));return e==null?(c,u=!1)=>vr(a,n,c,typeof u=="boolean"?u:!1):vr(a,n,e,o)};Zt.default=Zt;br.exports=Zt});var Cr=O((Pc,Rr)=>{Rr.exports=function(e){if(typeof e!="string"||e==="")return!1;for(var t;t=/(\\).|([@?!+*]\(.*\))/g.exec(e);){if(t[2])return!0;e=e.slice(t.index+t[0].length)}return!1}});var Jt=O((Ac,xr)=>{var Qn=Cr(),Er={"{":"}","(":")","[":"]"},Xn=function(s){if(s[0]==="!")return!0;for(var e=0,t=-2,r=-2,o=-2,i=-2,n=-2;e<s.length;){if(s[e]==="*"||s[e+1]==="?"&&/[\].+)]/.test(s[e])||r!==-1&&s[e]==="["&&s[e+1]!=="]"&&(r<e&&(r=s.indexOf("]",e)),r>e&&(n===-1||n>r||(n=s.indexOf("\\",e),n===-1||n>r)))||o!==-1&&s[e]==="{"&&s[e+1]!=="}"&&(o=s.indexOf("}",e),o>e&&(n=s.indexOf("\\",e),n===-1||n>o))||i!==-1&&s[e]==="("&&s[e+1]==="?"&&/[:!=]/.test(s[e+2])&&s[e+3]!==")"&&(i=s.indexOf(")",e),i>e&&(n=s.indexOf("\\",e),n===-1||n>i))||t!==-1&&s[e]==="("&&s[e+1]!=="|"&&(t<e&&(t=s.indexOf("|",e)),t!==-1&&s[t+1]!==")"&&(i=s.indexOf(")",t),i>t&&(n=s.indexOf("\\",t),n===-1||n>i))))return!0;if(s[e]==="\\"){var a=s[e+1];e+=2;var c=Er[a];if(c){var u=s.indexOf(c,e);u!==-1&&(e=u+1)}if(s[e]==="!")return!0}else e++}return!1},Zn=function(s){if(s[0]==="!")return!0;for(var e=0;e<s.length;){if(/[*?{}()[\]]/.test(s[e]))return!0;if(s[e]==="\\"){var t=s[e+1];e+=2;var r=Er[t];if(r){var o=s.indexOf(r,e);o!==-1&&(e=o+1)}if(s[e]==="!")return!0}else e++}return!1};xr.exports=function(e,t){if(typeof e!="string"||e==="")return!1;if(Qn(e))return!0;var r=Xn;return t&&t.strict===!1&&(r=Zn),r(e)}});var Pr=O((Tc,Sr)=>{"use strict";var Jn=Jt(),ei=require("path").posix.dirname,ti=require("os").platform()==="win32",es="/",si=/\\/g,ri=/[\{\[].*[\}\]]$/,oi=/(^|[^\\])([\{\[]|\([^\)]+$)/,ni=/\\([\!\*\?\|\[\]\(\)\{\}])/g;Sr.exports=function(e,t){var r=Object.assign({flipBackslashes:!0},t);r.flipBackslashes&&ti&&e.indexOf(es)<0&&(e=e.replace(si,es)),ri.test(e)&&(e+=es),e+="a";do e=ei(e);while(Jn(e)||oi.test(e));return e.replace(ni,"$1")}});var gt=O(le=>{"use strict";le.isInteger=s=>typeof s=="number"?Number.isInteger(s):typeof s=="string"&&s.trim()!==""?Number.isInteger(Number(s)):!1;le.find=(s,e)=>s.nodes.find(t=>t.type===e);le.exceedsLimit=(s,e,t=1,r)=>r===!1||!le.isInteger(s)||!le.isInteger(e)?!1:(Number(e)-Number(s))/Number(t)>=r;le.escapeNode=(s,e=0,t)=>{let r=s.nodes[e];r&&(t&&r.type===t||r.type==="open"||r.type==="close")&&r.escaped!==!0&&(r.value="\\"+r.value,r.escaped=!0)};le.encloseBrace=s=>s.type!=="brace"?!1:s.commas>>0+s.ranges>>0===0?(s.invalid=!0,!0):!1;le.isInvalidBrace=s=>s.type!=="brace"?!1:s.invalid===!0||s.dollar?!0:s.commas>>0+s.ranges>>0===0||s.open!==!0||s.close!==!0?(s.invalid=!0,!0):!1;le.isOpenOrClose=s=>s.type==="open"||s.type==="close"?!0:s.open===!0||s.close===!0;le.reduce=s=>s.reduce((e,t)=>(t.type==="text"&&e.push(t.value),t.type==="range"&&(t.type="text"),e),[]);le.flatten=(...s)=>{let e=[],t=r=>{for(let o=0;o<r.length;o++){let i=r[o];if(Array.isArray(i)){t(i);continue}i!==void 0&&e.push(i)}return e};return t(s),e}});var mt=O(($c,Tr)=>{"use strict";var Ar=gt();Tr.exports=(s,e={})=>{let t=(r,o={})=>{let i=e.escapeInvalid&&Ar.isInvalidBrace(o),n=r.invalid===!0&&e.escapeInvalid===!0,a="";if(r.value)return(i||n)&&Ar.isOpenOrClose(r)?"\\"+r.value:r.value;if(r.value)return r.value;if(r.nodes)for(let c of r.nodes)a+=t(c);return a};return t(s)}});var $r=O((Mc,Ir)=>{"use strict";Ir.exports=function(s){return typeof s=="number"?s-s===0:typeof s=="string"&&s.trim()!==""?Number.isFinite?Number.isFinite(+s):isFinite(+s):!1}});var jr=O((Dc,Br)=>{"use strict";var Mr=$r(),_e=(s,e,t)=>{if(Mr(s)===!1)throw new TypeError("toRegexRange: expected the first argument to be a number");if(e===void 0||s===e)return String(s);if(Mr(e)===!1)throw new TypeError("toRegexRange: expected the second argument to be a number.");let r={relaxZeros:!0,...t};typeof r.strictZeros=="boolean"&&(r.relaxZeros=r.strictZeros===!1);let o=String(r.relaxZeros),i=String(r.shorthand),n=String(r.capture),a=String(r.wrap),c=s+":"+e+"="+o+i+n+a;if(_e.cache.hasOwnProperty(c))return _e.cache[c].result;let u=Math.min(s,e),d=Math.max(s,e);if(Math.abs(u-d)===1){let y=s+"|"+e;return r.capture?`(${y})`:r.wrap===!1?y:`(?:${y})`}let p=Nr(s)||Nr(e),l={min:s,max:e,a:u,b:d},f=[],v=[];if(p&&(l.isPadded=p,l.maxLen=String(l.max).length),u<0){let y=d<0?Math.abs(d):1;v=Dr(y,Math.abs(u),l,r),u=l.a=0}return d>=0&&(f=Dr(u,d,l,r)),l.negatives=v,l.positives=f,l.result=ii(v,f,r),r.capture===!0?l.result=`(${l.result})`:r.wrap!==!1&&f.length+v.length>1&&(l.result=`(?:${l.result})`),_e.cache[c]=l,l.result};function ii(s,e,t){let r=ts(s,e,"-",!1,t)||[],o=ts(e,s,"",!1,t)||[],i=ts(s,e,"-?",!0,t)||[];return r.concat(i).concat(o).join("|")}function ai(s,e){let t=1,r=1,o=Lr(s,t),i=new Set([e]);for(;s<=o&&o<=e;)i.add(o),t+=1,o=Lr(s,t);for(o=Hr(e+1,r)-1;s<o&&o<=e;)i.add(o),r+=1,o=Hr(e+1,r)-1;return i=[...i],i.sort(di),i}function ci(s,e,t){if(s===e)return{pattern:s,count:[],digits:0};let r=li(s,e),o=r.length,i="",n=0;for(let a=0;a<o;a++){let[c,u]=r[a];c===u?i+=c:c!=="0"||u!=="9"?i+=ui(c,u,t):n++}return n&&(i+=t.shorthand===!0?"\\d":"[0-9]"),{pattern:i,count:[n],digits:o}}function Dr(s,e,t,r){let o=ai(s,e),i=[],n=s,a;for(let c=0;c<o.length;c++){let u=o[c],d=ci(String(n),String(u),r),p="";if(!t.isPadded&&a&&a.pattern===d.pattern){a.count.length>1&&a.count.pop(),a.count.push(d.count[0]),a.string=a.pattern+Or(a.count),n=u+1;continue}t.isPadded&&(p=pi(u,t,r)),d.string=p+d.pattern+Or(d.count),i.push(d),n=u+1,a=d}return i}function ts(s,e,t,r,o){let i=[];for(let n of s){let{string:a}=n;!r&&!Fr(e,"string",a)&&i.push(t+a),r&&Fr(e,"string",a)&&i.push(t+a)}return i}function li(s,e){let t=[];for(let r=0;r<s.length;r++)t.push([s[r],e[r]]);return t}function di(s,e){return s>e?1:e>s?-1:0}function Fr(s,e,t){return s.some(r=>r[e]===t)}function Lr(s,e){return Number(String(s).slice(0,-e)+"9".repeat(e))}function Hr(s,e){return s-s%Math.pow(10,e)}function Or(s){let[e=0,t=""]=s;return t||e>1?`{${e+(t?","+t:"")}}`:""}function ui(s,e,t){return`[${s}${e-s===1?"":"-"}${e}]`}function Nr(s){return/^-?(0+)\d/.test(s)}function pi(s,e,t){if(!e.isPadded)return s;let r=Math.abs(e.maxLen-String(s).length),o=t.relaxZeros!==!1;switch(r){case 0:return"";case 1:return o?"0?":"0";case 2:return o?"0{0,2}":"00";default:return o?`0{0,${r}}`:`0{${r}}`}}_e.cache={};_e.clearCache=()=>_e.cache={};Br.exports=_e});var os=O((Fc,Vr)=>{"use strict";var hi=require("util"),Ur=jr(),Wr=s=>s!==null&&typeof s=="object"&&!Array.isArray(s),fi=s=>e=>s===!0?Number(e):String(e),ss=s=>typeof s=="number"||typeof s=="string"&&s!=="",Ne=s=>Number.isInteger(+s),rs=s=>{let e=`${s}`,t=-1;if(e[0]==="-"&&(e=e.slice(1)),e==="0")return!1;for(;e[++t]==="0";);return t>0},gi=(s,e,t)=>typeof s=="string"||typeof e=="string"?!0:t.stringify===!0,mi=(s,e,t)=>{if(e>0){let r=s[0]==="-"?"-":"";r&&(s=s.slice(1)),s=r+s.padStart(r?e-1:e,"0")}return t===!1?String(s):s},vt=(s,e)=>{let t=s[0]==="-"?"-":"";for(t&&(s=s.slice(1),e--);s.length<e;)s="0"+s;return t?"-"+s:s},wi=(s,e,t)=>{s.negatives.sort((a,c)=>a<c?-1:a>c?1:0),s.positives.sort((a,c)=>a<c?-1:a>c?1:0);let r=e.capture?"":"?:",o="",i="",n;return s.positives.length&&(o=s.positives.map(a=>vt(String(a),t)).join("|")),s.negatives.length&&(i=`-(${r}${s.negatives.map(a=>vt(String(a),t)).join("|")})`),o&&i?n=`${o}|${i}`:n=o||i,e.wrap?`(${r}${n})`:n},Gr=(s,e,t,r)=>{if(t)return Ur(s,e,{wrap:!1,...r});let o=String.fromCharCode(s);if(s===e)return o;let i=String.fromCharCode(e);return`[${o}-${i}]`},qr=(s,e,t)=>{if(Array.isArray(s)){let r=t.wrap===!0,o=t.capture?"":"?:";return r?`(${o}${s.join("|")})`:s.join("|")}return Ur(s,e,t)},zr=(...s)=>new RangeError("Invalid range arguments: "+hi.inspect(...s)),Kr=(s,e,t)=>{if(t.strictRanges===!0)throw zr([s,e]);return[]},vi=(s,e)=>{if(e.strictRanges===!0)throw new TypeError(`Expected step "${s}" to be a number`);return[]},yi=(s,e,t=1,r={})=>{let o=Number(s),i=Number(e);if(!Number.isInteger(o)||!Number.isInteger(i)){if(r.strictRanges===!0)throw zr([s,e]);return[]}o===0&&(o=0),i===0&&(i=0);let n=o>i,a=String(s),c=String(e),u=String(t);t=Math.max(Math.abs(t),1);let d=rs(a)||rs(c)||rs(u),p=d?Math.max(a.length,c.length,u.length):0,l=d===!1&&gi(s,e,r)===!1,f=r.transform||fi(l);if(r.toRegex&&t===1)return Gr(vt(s,p),vt(e,p),!0,r);let v={negatives:[],positives:[]},y=S=>v[S<0?"negatives":"positives"].push(Math.abs(S)),R=[],P=0;for(;n?o>=i:o<=i;)r.toRegex===!0&&t>1?y(o):R.push(mi(f(o,P),p,l)),o=n?o-t:o+t,P++;return r.toRegex===!0?t>1?wi(v,r,p):qr(R,null,{wrap:!1,...r}):R},_i=(s,e,t=1,r={})=>{if(!Ne(s)&&s.length>1||!Ne(e)&&e.length>1)return Kr(s,e,r);let o=r.transform||(l=>String.fromCharCode(l)),i=`${s}`.charCodeAt(0),n=`${e}`.charCodeAt(0),a=i>n,c=Math.min(i,n),u=Math.max(i,n);if(r.toRegex&&t===1)return Gr(c,u,!1,r);let d=[],p=0;for(;a?i>=n:i<=n;)d.push(o(i,p)),i=a?i-t:i+t,p++;return r.toRegex===!0?qr(d,null,{wrap:!1,options:r}):d},wt=(s,e,t,r={})=>{if(e==null&&ss(s))return[s];if(!ss(s)||!ss(e))return Kr(s,e,r);if(typeof t=="function")return wt(s,e,1,{transform:t});if(Wr(t))return wt(s,e,0,t);let o={...r};return o.capture===!0&&(o.wrap=!0),t=t||o.step||1,Ne(t)?Ne(s)&&Ne(e)?yi(s,e,t,o):_i(s,e,Math.max(Math.abs(t),1),o):t!=null&&!Wr(t)?vi(t,o):wt(s,e,1,t)};Vr.exports=wt});var Xr=O((Lc,Qr)=>{"use strict";var bi=os(),Yr=gt(),ki=(s,e={})=>{let t=(r,o={})=>{let i=Yr.isInvalidBrace(o),n=r.invalid===!0&&e.escapeInvalid===!0,a=i===!0||n===!0,c=e.escapeInvalid===!0?"\\":"",u="";if(r.isOpen===!0)return c+r.value;if(r.isClose===!0)return console.log("node.isClose",c,r.value),c+r.value;if(r.type==="open")return a?c+r.value:"(";if(r.type==="close")return a?c+r.value:")";if(r.type==="comma")return r.prev.type==="comma"?"":a?r.value:"|";if(r.value)return r.value;if(r.nodes&&r.ranges>0){let d=Yr.reduce(r.nodes),p=bi(...d,{...e,wrap:!1,toRegex:!0,strictZeros:!0});if(p.length!==0)return d.length>1&&p.length>1?`(${p})`:p}if(r.nodes)for(let d of r.nodes)u+=t(d,r);return u};return t(s)};Qr.exports=ki});var eo=O((Hc,Jr)=>{"use strict";var Ri=os(),Zr=mt(),Pe=gt(),be=(s="",e="",t=!1)=>{let r=[];if(s=[].concat(s),e=[].concat(e),!e.length)return s;if(!s.length)return t?Pe.flatten(e).map(o=>`{${o}}`):e;for(let o of s)if(Array.isArray(o))for(let i of o)r.push(be(i,e,t));else for(let i of e)t===!0&&typeof i=="string"&&(i=`{${i}}`),r.push(Array.isArray(i)?be(o,i,t):o+i);return Pe.flatten(r)},Ci=(s,e={})=>{let t=e.rangeLimit===void 0?1e3:e.rangeLimit,r=(o,i={})=>{o.queue=[];let n=i,a=i.queue;for(;n.type!=="brace"&&n.type!=="root"&&n.parent;)n=n.parent,a=n.queue;if(o.invalid||o.dollar){a.push(be(a.pop(),Zr(o,e)));return}if(o.type==="brace"&&o.invalid!==!0&&o.nodes.length===2){a.push(be(a.pop(),["{}"]));return}if(o.nodes&&o.ranges>0){let p=Pe.reduce(o.nodes);if(Pe.exceedsLimit(...p,e.step,t))throw new RangeError("expanded array length exceeds range limit. Use options.rangeLimit to increase or disable the limit.");let l=Ri(...p,e);l.length===0&&(l=Zr(o,e)),a.push(be(a.pop(),l)),o.nodes=[];return}let c=Pe.encloseBrace(o),u=o.queue,d=o;for(;d.type!=="brace"&&d.type!=="root"&&d.parent;)d=d.parent,u=d.queue;for(let p=0;p<o.nodes.length;p++){let l=o.nodes[p];if(l.type==="comma"&&o.type==="brace"){p===1&&u.push(""),u.push("");continue}if(l.type==="close"){a.push(be(a.pop(),u,c));continue}if(l.value&&l.type!=="open"){u.push(be(u.pop(),l.value));continue}l.nodes&&r(l,o)}return u};return Pe.flatten(r(s))};Jr.exports=Ci});var so=O((Oc,to)=>{"use strict";to.exports={MAX_LENGTH:1e4,CHAR_0:"0",CHAR_9:"9",CHAR_UPPERCASE_A:"A",CHAR_LOWERCASE_A:"a",CHAR_UPPERCASE_Z:"Z",CHAR_LOWERCASE_Z:"z",CHAR_LEFT_PARENTHESES:"(",CHAR_RIGHT_PARENTHESES:")",CHAR_ASTERISK:"*",CHAR_AMPERSAND:"&",CHAR_AT:"@",CHAR_BACKSLASH:"\\",CHAR_BACKTICK:"`",CHAR_CARRIAGE_RETURN:"\r",CHAR_CIRCUMFLEX_ACCENT:"^",CHAR_COLON:":",CHAR_COMMA:",",CHAR_DOLLAR:"$",CHAR_DOT:".",CHAR_DOUBLE_QUOTE:'"',CHAR_EQUAL:"=",CHAR_EXCLAMATION_MARK:"!",CHAR_FORM_FEED:"\f",CHAR_FORWARD_SLASH:"/",CHAR_HASH:"#",CHAR_HYPHEN_MINUS:"-",CHAR_LEFT_ANGLE_BRACKET:"<",CHAR_LEFT_CURLY_BRACE:"{",CHAR_LEFT_SQUARE_BRACKET:"[",CHAR_LINE_FEED:`
`,CHAR_NO_BREAK_SPACE:"\xA0",CHAR_PERCENT:"%",CHAR_PLUS:"+",CHAR_QUESTION_MARK:"?",CHAR_RIGHT_ANGLE_BRACKET:">",CHAR_RIGHT_CURLY_BRACE:"}",CHAR_RIGHT_SQUARE_BRACKET:"]",CHAR_SEMICOLON:";",CHAR_SINGLE_QUOTE:"'",CHAR_SPACE:" ",CHAR_TAB:"	",CHAR_UNDERSCORE:"_",CHAR_VERTICAL_LINE:"|",CHAR_ZERO_WIDTH_NOBREAK_SPACE:"\uFEFF"}});var ao=O((Nc,io)=>{"use strict";var Ei=mt(),{MAX_LENGTH:ro,CHAR_BACKSLASH:ns,CHAR_BACKTICK:xi,CHAR_COMMA:Si,CHAR_DOT:Pi,CHAR_LEFT_PARENTHESES:Ai,CHAR_RIGHT_PARENTHESES:Ti,CHAR_LEFT_CURLY_BRACE:Ii,CHAR_RIGHT_CURLY_BRACE:$i,CHAR_LEFT_SQUARE_BRACKET:oo,CHAR_RIGHT_SQUARE_BRACKET:no,CHAR_DOUBLE_QUOTE:Mi,CHAR_SINGLE_QUOTE:Di,CHAR_NO_BREAK_SPACE:Fi,CHAR_ZERO_WIDTH_NOBREAK_SPACE:Li}=so(),Hi=(s,e={})=>{if(typeof s!="string")throw new TypeError("Expected a string");let t=e||{},r=typeof t.maxLength=="number"?Math.min(ro,t.maxLength):ro;if(s.length>r)throw new SyntaxError(`Input length (${s.length}), exceeds max characters (${r})`);let o={type:"root",input:s,nodes:[]},i=[o],n=o,a=o,c=0,u=s.length,d=0,p=0,l,f=()=>s[d++],v=y=>{if(y.type==="text"&&a.type==="dot"&&(a.type="text"),a&&a.type==="text"&&y.type==="text"){a.value+=y.value;return}return n.nodes.push(y),y.parent=n,y.prev=a,a=y,y};for(v({type:"bos"});d<u;)if(n=i[i.length-1],l=f(),!(l===Li||l===Fi)){if(l===ns){v({type:"text",value:(e.keepEscaping?l:"")+f()});continue}if(l===no){v({type:"text",value:"\\"+l});continue}if(l===oo){c++;let y;for(;d<u&&(y=f());){if(l+=y,y===oo){c++;continue}if(y===ns){l+=f();continue}if(y===no&&(c--,c===0))break}v({type:"text",value:l});continue}if(l===Ai){n=v({type:"paren",nodes:[]}),i.push(n),v({type:"text",value:l});continue}if(l===Ti){if(n.type!=="paren"){v({type:"text",value:l});continue}n=i.pop(),v({type:"text",value:l}),n=i[i.length-1];continue}if(l===Mi||l===Di||l===xi){let y=l,R;for(e.keepQuotes!==!0&&(l="");d<u&&(R=f());){if(R===ns){l+=R+f();continue}if(R===y){e.keepQuotes===!0&&(l+=R);break}l+=R}v({type:"text",value:l});continue}if(l===Ii){p++;let R={type:"brace",open:!0,close:!1,dollar:a.value&&a.value.slice(-1)==="$"||n.dollar===!0,depth:p,commas:0,ranges:0,nodes:[]};n=v(R),i.push(n),v({type:"open",value:l});continue}if(l===$i){if(n.type!=="brace"){v({type:"text",value:l});continue}let y="close";n=i.pop(),n.close=!0,v({type:y,value:l}),p--,n=i[i.length-1];continue}if(l===Si&&p>0){if(n.ranges>0){n.ranges=0;let y=n.nodes.shift();n.nodes=[y,{type:"text",value:Ei(n)}]}v({type:"comma",value:l}),n.commas++;continue}if(l===Pi&&p>0&&n.commas===0){let y=n.nodes;if(p===0||y.length===0){v({type:"text",value:l});continue}if(a.type==="dot"){if(n.range=[],a.value+=l,a.type="range",n.nodes.length!==3&&n.nodes.length!==5){n.invalid=!0,n.ranges=0,a.type="text";continue}n.ranges++,n.args=[];continue}if(a.type==="range"){y.pop();let R=y[y.length-1];R.value+=a.value+l,a=R,n.ranges--;continue}v({type:"dot",value:l});continue}v({type:"text",value:l})}do if(n=i.pop(),n.type!=="root"){n.nodes.forEach(P=>{P.nodes||(P.type==="open"&&(P.isOpen=!0),P.type==="close"&&(P.isClose=!0),P.nodes||(P.type="text"),P.invalid=!0)});let y=i[i.length-1],R=y.nodes.indexOf(n);y.nodes.splice(R,1,...n.nodes)}while(i.length>0);return v({type:"eos"}),o};io.exports=Hi});var uo=O((Bc,lo)=>{"use strict";var co=mt(),Oi=Xr(),Ni=eo(),Bi=ao(),ae=(s,e={})=>{let t=[];if(Array.isArray(s))for(let r of s){let o=ae.create(r,e);Array.isArray(o)?t.push(...o):t.push(o)}else t=[].concat(ae.create(s,e));return e&&e.expand===!0&&e.nodupes===!0&&(t=[...new Set(t)]),t};ae.parse=(s,e={})=>Bi(s,e);ae.stringify=(s,e={})=>co(typeof s=="string"?ae.parse(s,e):s,e);ae.compile=(s,e={})=>(typeof s=="string"&&(s=ae.parse(s,e)),Oi(s,e));ae.expand=(s,e={})=>{typeof s=="string"&&(s=ae.parse(s,e));let t=Ni(s,e);return e.noempty===!0&&(t=t.filter(Boolean)),e.nodupes===!0&&(t=[...new Set(t)]),t};ae.create=(s,e={})=>s===""||s.length<3?[s]:e.expand!==!0?ae.compile(s,e):ae.expand(s,e);lo.exports=ae});var po=O((jc,ji)=>{ji.exports=["3dm","3ds","3g2","3gp","7z","a","aac","adp","afdesign","afphoto","afpub","ai","aif","aiff","alz","ape","apk","appimage","ar","arj","asf","au","avi","bak","baml","bh","bin","bk","bmp","btif","bz2","bzip2","cab","caf","cgm","class","cmx","cpio","cr2","cur","dat","dcm","deb","dex","djvu","dll","dmg","dng","doc","docm","docx","dot","dotm","dra","DS_Store","dsk","dts","dtshd","dvb","dwg","dxf","ecelp4800","ecelp7470","ecelp9600","egg","eol","eot","epub","exe","f4v","fbs","fh","fla","flac","flatpak","fli","flv","fpx","fst","fvt","g3","gh","gif","graffle","gz","gzip","h261","h263","h264","icns","ico","ief","img","ipa","iso","jar","jpeg","jpg","jpgv","jpm","jxr","key","ktx","lha","lib","lvp","lz","lzh","lzma","lzo","m3u","m4a","m4v","mar","mdi","mht","mid","midi","mj2","mka","mkv","mmr","mng","mobi","mov","movie","mp3","mp4","mp4a","mpeg","mpg","mpga","mxu","nef","npx","numbers","nupkg","o","odp","ods","odt","oga","ogg","ogv","otf","ott","pages","pbm","pcx","pdb","pdf","pea","pgm","pic","png","pnm","pot","potm","potx","ppa","ppam","ppm","pps","ppsm","ppsx","ppt","pptm","pptx","psd","pya","pyc","pyo","pyv","qt","rar","ras","raw","resources","rgb","rip","rlc","rmf","rmvb","rpm","rtf","rz","s3m","s7z","scpt","sgi","shar","snap","sil","sketch","slk","smv","snk","so","stl","suo","sub","swf","tar","tbz","tbz2","tga","tgz","thmx","tif","tiff","tlz","ttc","ttf","txz","udf","uvh","uvi","uvm","uvp","uvs","uvu","viv","vob","war","wav","wax","wbmp","wdp","weba","webm","webp","whl","wim","wm","wma","wmv","wmx","woff","woff2","wrm","wvx","xbm","xif","xla","xlam","xls","xlsb","xlsm","xlsx","xlt","xltm","xltx","xm","xmind","xpi","xpm","xwd","xz","z","zip","zipx"]});var fo=O((Wc,ho)=>{ho.exports=po()});var mo=O((Uc,go)=>{"use strict";var Wi=require("path"),Ui=fo(),Gi=new Set(Ui);go.exports=s=>Gi.has(Wi.extname(s).slice(1).toLowerCase())});var yt=O(x=>{"use strict";var{sep:qi}=require("path"),{platform:is}=process,zi=require("os");x.EV_ALL="all";x.EV_READY="ready";x.EV_ADD="add";x.EV_CHANGE="change";x.EV_ADD_DIR="addDir";x.EV_UNLINK="unlink";x.EV_UNLINK_DIR="unlinkDir";x.EV_RAW="raw";x.EV_ERROR="error";x.STR_DATA="data";x.STR_END="end";x.STR_CLOSE="close";x.FSEVENT_CREATED="created";x.FSEVENT_MODIFIED="modified";x.FSEVENT_DELETED="deleted";x.FSEVENT_MOVED="moved";x.FSEVENT_CLONED="cloned";x.FSEVENT_UNKNOWN="unknown";x.FSEVENT_FLAG_MUST_SCAN_SUBDIRS=1;x.FSEVENT_TYPE_FILE="file";x.FSEVENT_TYPE_DIRECTORY="directory";x.FSEVENT_TYPE_SYMLINK="symlink";x.KEY_LISTENERS="listeners";x.KEY_ERR="errHandlers";x.KEY_RAW="rawEmitters";x.HANDLER_KEYS=[x.KEY_LISTENERS,x.KEY_ERR,x.KEY_RAW];x.DOT_SLASH=`.${qi}`;x.BACK_SLASH_RE=/\\/g;x.DOUBLE_SLASH_RE=/\/\//;x.SLASH_OR_BACK_SLASH_RE=/[/\\]/;x.DOT_RE=/\..*\.(sw[px])$|~$|\.subl.*\.tmp/;x.REPLACER_RE=/^\.[/\\]/;x.SLASH="/";x.SLASH_SLASH="//";x.BRACE_START="{";x.BANG="!";x.ONE_DOT=".";x.TWO_DOTS="..";x.STAR="*";x.GLOBSTAR="**";x.ROOT_GLOBSTAR="/**/*";x.SLASH_GLOBSTAR="/**";x.DIR_SUFFIX="Dir";x.ANYMATCH_OPTS={dot:!0};x.STRING_TYPE="string";x.FUNCTION_TYPE="function";x.EMPTY_STR="";x.EMPTY_FN=()=>{};x.IDENTITY_FN=s=>s;x.isWindows=is==="win32";x.isMacos=is==="darwin";x.isLinux=is==="linux";x.isIBMi=zi.type()==="OS400"});var ko=O((qc,bo)=>{"use strict";var ve=require("fs"),Q=require("path"),{promisify:Ue}=require("util"),Ki=mo(),{isWindows:Vi,isLinux:Yi,EMPTY_FN:Qi,EMPTY_STR:Xi,KEY_LISTENERS:Ae,KEY_ERR:as,KEY_RAW:Be,HANDLER_KEYS:Zi,EV_CHANGE:bt,EV_ADD:_t,EV_ADD_DIR:Ji,EV_ERROR:vo,STR_DATA:ea,STR_END:ta,BRACE_START:sa,STAR:ra}=yt(),oa="watch",na=Ue(ve.open),yo=Ue(ve.stat),ia=Ue(ve.lstat),aa=Ue(ve.close),cs=Ue(ve.realpath),ca={lstat:ia,stat:yo},ds=(s,e)=>{s instanceof Set?s.forEach(e):e(s)},je=(s,e,t)=>{let r=s[e];r instanceof Set||(s[e]=r=new Set([r])),r.add(t)},la=s=>e=>{let t=s[e];t instanceof Set?t.clear():delete s[e]},We=(s,e,t)=>{let r=s[e];r instanceof Set?r.delete(t):r===t&&delete s[e]},_o=s=>s instanceof Set?s.size===0:!s,kt=new Map;function wo(s,e,t,r,o){let i=(n,a)=>{t(s),o(n,a,{watchedPath:s}),a&&s!==a&&Rt(Q.resolve(s,a),Ae,Q.join(s,a))};try{return ve.watch(s,e,i)}catch(n){r(n)}}var Rt=(s,e,t,r,o)=>{let i=kt.get(s);i&&ds(i[e],n=>{n(t,r,o)})},da=(s,e,t,r)=>{let{listener:o,errHandler:i,rawEmitter:n}=r,a=kt.get(e),c;if(!t.persistent)return c=wo(s,t,o,i,n),c.close.bind(c);if(a)je(a,Ae,o),je(a,as,i),je(a,Be,n);else{if(c=wo(s,t,Rt.bind(null,e,Ae),i,Rt.bind(null,e,Be)),!c)return;c.on(vo,async u=>{let d=Rt.bind(null,e,as);if(a.watcherUnusable=!0,Vi&&u.code==="EPERM")try{let p=await na(s,"r");await aa(p),d(u)}catch{}else d(u)}),a={listeners:o,errHandlers:i,rawEmitters:n,watcher:c},kt.set(e,a)}return()=>{We(a,Ae,o),We(a,as,i),We(a,Be,n),_o(a.listeners)&&(a.watcher.close(),kt.delete(e),Zi.forEach(la(a)),a.watcher=void 0,Object.freeze(a))}},ls=new Map,ua=(s,e,t,r)=>{let{listener:o,rawEmitter:i}=r,n=ls.get(e),a=new Set,c=new Set,u=n&&n.options;return u&&(u.persistent<t.persistent||u.interval>t.interval)&&(a=n.listeners,c=n.rawEmitters,ve.unwatchFile(e),n=void 0),n?(je(n,Ae,o),je(n,Be,i)):(n={listeners:o,rawEmitters:i,options:t,watcher:ve.watchFile(e,t,(d,p)=>{ds(n.rawEmitters,f=>{f(bt,e,{curr:d,prev:p})});let l=d.mtimeMs;(d.size!==p.size||l>p.mtimeMs||l===0)&&ds(n.listeners,f=>f(s,d))})},ls.set(e,n)),()=>{We(n,Ae,o),We(n,Be,i),_o(n.listeners)&&(ls.delete(e),ve.unwatchFile(e),n.options=n.watcher=void 0,Object.freeze(n))}},us=class{constructor(e){this.fsw=e,this._boundHandleError=t=>e._handleError(t)}_watchWithNodeFs(e,t){let r=this.fsw.options,o=Q.dirname(e),i=Q.basename(e);this.fsw._getWatchedDir(o).add(i);let a=Q.resolve(e),c={persistent:r.persistent};t||(t=Qi);let u;return r.usePolling?(c.interval=r.enableBinaryInterval&&Ki(i)?r.binaryInterval:r.interval,u=ua(e,a,c,{listener:t,rawEmitter:this.fsw._emitRaw})):u=da(e,a,c,{listener:t,errHandler:this._boundHandleError,rawEmitter:this.fsw._emitRaw}),u}_handleFile(e,t,r){if(this.fsw.closed)return;let o=Q.dirname(e),i=Q.basename(e),n=this.fsw._getWatchedDir(o),a=t;if(n.has(i))return;let c=async(d,p)=>{if(this.fsw._throttle(oa,e,5)){if(!p||p.mtimeMs===0)try{let l=await yo(e);if(this.fsw.closed)return;let f=l.atimeMs,v=l.mtimeMs;(!f||f<=v||v!==a.mtimeMs)&&this.fsw._emit(bt,e,l),Yi&&a.ino!==l.ino?(this.fsw._closeFile(d),a=l,this.fsw._addPathCloser(d,this._watchWithNodeFs(e,c))):a=l}catch{this.fsw._remove(o,i)}else if(n.has(i)){let l=p.atimeMs,f=p.mtimeMs;(!l||l<=f||f!==a.mtimeMs)&&this.fsw._emit(bt,e,p),a=p}}},u=this._watchWithNodeFs(e,c);if(!(r&&this.fsw.options.ignoreInitial)&&this.fsw._isntIgnored(e)){if(!this.fsw._throttle(_t,e,0))return;this.fsw._emit(_t,e,t)}return u}async _handleSymlink(e,t,r,o){if(this.fsw.closed)return;let i=e.fullPath,n=this.fsw._getWatchedDir(t);if(!this.fsw.options.followSymlinks){this.fsw._incrReadyCount();let a;try{a=await cs(r)}catch{return this.fsw._emitReady(),!0}return this.fsw.closed?void 0:(n.has(o)?this.fsw._symlinkPaths.get(i)!==a&&(this.fsw._symlinkPaths.set(i,a),this.fsw._emit(bt,r,e.stats)):(n.add(o),this.fsw._symlinkPaths.set(i,a),this.fsw._emit(_t,r,e.stats)),this.fsw._emitReady(),!0)}if(this.fsw._symlinkPaths.has(i))return!0;this.fsw._symlinkPaths.set(i,!0)}_handleRead(e,t,r,o,i,n,a){if(e=Q.join(e,Xi),!r.hasGlob&&(a=this.fsw._throttle("readdir",e,1e3),!a))return;let c=this.fsw._getWatchedDir(r.path),u=new Set,d=this.fsw._readdirp(e,{fileFilter:p=>r.filterPath(p),directoryFilter:p=>r.filterDir(p),depth:0}).on(ea,async p=>{if(this.fsw.closed){d=void 0;return}let l=p.path,f=Q.join(e,l);if(u.add(l),!(p.stats.isSymbolicLink()&&await this._handleSymlink(p,e,f,l))){if(this.fsw.closed){d=void 0;return}(l===o||!o&&!c.has(l))&&(this.fsw._incrReadyCount(),f=Q.join(i,Q.relative(i,f)),this._addToNodeFs(f,t,r,n+1))}}).on(vo,this._boundHandleError);return new Promise(p=>d.once(ta,()=>{if(this.fsw.closed){d=void 0;return}let l=a?a.clear():!1;p(),c.getChildren().filter(f=>f!==e&&!u.has(f)&&(!r.hasGlob||r.filterPath({fullPath:Q.resolve(e,f)}))).forEach(f=>{this.fsw._remove(e,f)}),d=void 0,l&&this._handleRead(e,!1,r,o,i,n,a)}))}async _handleDir(e,t,r,o,i,n,a){let c=this.fsw._getWatchedDir(Q.dirname(e)),u=c.has(Q.basename(e));!(r&&this.fsw.options.ignoreInitial)&&!i&&!u&&(!n.hasGlob||n.globFilter(e))&&this.fsw._emit(Ji,e,t),c.add(Q.basename(e)),this.fsw._getWatchedDir(e);let d,p,l=this.fsw.options.depth;if((l==null||o<=l)&&!this.fsw._symlinkPaths.has(a)){if(!i&&(await this._handleRead(e,r,n,i,e,o,d),this.fsw.closed))return;p=this._watchWithNodeFs(e,(f,v)=>{v&&v.mtimeMs===0||this._handleRead(f,!1,n,i,e,o,d)})}return p}async _addToNodeFs(e,t,r,o,i){let n=this.fsw._emitReady;if(this.fsw._isIgnored(e)||this.fsw.closed)return n(),!1;let a=this.fsw._getWatchHelpers(e,o);!a.hasGlob&&r&&(a.hasGlob=r.hasGlob,a.globFilter=r.globFilter,a.filterPath=c=>r.filterPath(c),a.filterDir=c=>r.filterDir(c));try{let c=await ca[a.statMethod](a.watchPath);if(this.fsw.closed)return;if(this.fsw._isIgnored(a.watchPath,c))return n(),!1;let u=this.fsw.options.followSymlinks&&!e.includes(ra)&&!e.includes(sa),d;if(c.isDirectory()){let p=Q.resolve(e),l=u?await cs(e):e;if(this.fsw.closed||(d=await this._handleDir(a.watchPath,c,t,o,i,a,l),this.fsw.closed))return;p!==l&&l!==void 0&&this.fsw._symlinkPaths.set(p,l)}else if(c.isSymbolicLink()){let p=u?await cs(e):e;if(this.fsw.closed)return;let l=Q.dirname(a.watchPath);if(this.fsw._getWatchedDir(l).add(a.watchPath),this.fsw._emit(_t,a.watchPath,c),d=await this._handleDir(l,c,t,o,e,a,p),this.fsw.closed)return;p!==void 0&&this.fsw._symlinkPaths.set(Q.resolve(e),p)}else d=this._handleFile(a.watchPath,c,t);return n(),this.fsw._addPathCloser(e,d),!1}catch(c){if(this.fsw._handleError(c))return n(),e}}};bo.exports=us});var Ao=O((zc,ys)=>{"use strict";var ws=require("fs"),X=require("path"),{promisify:vs}=require("util"),Te;try{Te=require("fsevents")}catch(s){process.env.CHOKIDAR_PRINT_FSEVENTS_REQUIRE_ERROR&&console.error(s)}if(Te){let s=process.version.match(/v(\d+)\.(\d+)/);if(s&&s[1]&&s[2]){let e=Number.parseInt(s[1],10),t=Number.parseInt(s[2],10);e===8&&t<16&&(Te=void 0)}}var{EV_ADD:ps,EV_CHANGE:pa,EV_ADD_DIR:Ro,EV_UNLINK:Ct,EV_ERROR:ha,STR_DATA:fa,STR_END:ga,FSEVENT_CREATED:ma,FSEVENT_MODIFIED:wa,FSEVENT_DELETED:va,FSEVENT_MOVED:ya,FSEVENT_UNKNOWN:_a,FSEVENT_FLAG_MUST_SCAN_SUBDIRS:ba,FSEVENT_TYPE_FILE:ka,FSEVENT_TYPE_DIRECTORY:Ge,FSEVENT_TYPE_SYMLINK:Po,ROOT_GLOBSTAR:Co,DIR_SUFFIX:Ra,DOT_SLASH:Eo,FUNCTION_TYPE:hs,EMPTY_FN:Ca,IDENTITY_FN:Ea}=yt(),xa=s=>isNaN(s)?{}:{depth:s},gs=vs(ws.stat),Sa=vs(ws.lstat),xo=vs(ws.realpath),Pa={stat:gs,lstat:Sa},ke=new Map,Aa=10,Ta=new Set([69888,70400,71424,72704,73472,131328,131840,262912]),Ia=(s,e)=>({stop:Te.watch(s,e)});function $a(s,e,t,r){let o=X.extname(e)?X.dirname(e):e,i=X.dirname(o),n=ke.get(o);Ma(i)&&(o=i);let a=X.resolve(s),c=a!==e,u=(p,l,f)=>{c&&(p=p.replace(e,a)),(p===a||!p.indexOf(a+X.sep))&&t(p,l,f)},d=!1;for(let p of ke.keys())if(e.indexOf(X.resolve(p)+X.sep)===0){o=p,n=ke.get(o),d=!0;break}return n||d?n.listeners.add(u):(n={listeners:new Set([u]),rawEmitter:r,watcher:Ia(o,(p,l)=>{if(!n.listeners.size||l&ba)return;let f=Te.getInfo(p,l);n.listeners.forEach(v=>{v(p,l,f)}),n.rawEmitter(f.event,p,f)})},ke.set(o,n)),()=>{let p=n.listeners;if(p.delete(u),!p.size&&(ke.delete(o),n.watcher))return n.watcher.stop().then(()=>{n.rawEmitter=n.watcher=void 0,Object.freeze(n)})}}var Ma=s=>{let e=0;for(let t of ke.keys())if(t.indexOf(s)===0&&(e++,e>=Aa))return!0;return!1},Da=()=>Te&&ke.size<128,fs=(s,e)=>{let t=0;for(;!s.indexOf(e)&&(s=X.dirname(s))!==e;)t++;return t},So=(s,e)=>s.type===Ge&&e.isDirectory()||s.type===Po&&e.isSymbolicLink()||s.type===ka&&e.isFile(),ms=class{constructor(e){this.fsw=e}checkIgnored(e,t){let r=this.fsw._ignoredPaths;if(this.fsw._isIgnored(e,t))return r.add(e),t&&t.isDirectory()&&r.add(e+Co),!0;r.delete(e),r.delete(e+Co)}addOrChange(e,t,r,o,i,n,a,c){let u=i.has(n)?pa:ps;this.handleEvent(u,e,t,r,o,i,n,a,c)}async checkExists(e,t,r,o,i,n,a,c){try{let u=await gs(e);if(this.fsw.closed)return;So(a,u)?this.addOrChange(e,t,r,o,i,n,a,c):this.handleEvent(Ct,e,t,r,o,i,n,a,c)}catch(u){u.code==="EACCES"?this.addOrChange(e,t,r,o,i,n,a,c):this.handleEvent(Ct,e,t,r,o,i,n,a,c)}}handleEvent(e,t,r,o,i,n,a,c,u){if(!(this.fsw.closed||this.checkIgnored(t)))if(e===Ct){let d=c.type===Ge;(d||n.has(a))&&this.fsw._remove(i,a,d)}else{if(e===ps){if(c.type===Ge&&this.fsw._getWatchedDir(t),c.type===Po&&u.followSymlinks){let p=u.depth===void 0?void 0:fs(r,o)+1;return this._addToFsEvents(t,!1,!0,p)}this.fsw._getWatchedDir(i).add(a)}let d=c.type===Ge?e+Ra:e;this.fsw._emit(d,t),d===Ro&&this._addToFsEvents(t,!1,!0)}}_watchWithFsEvents(e,t,r,o){if(this.fsw.closed||this.fsw._isIgnored(e))return;let i=this.fsw.options,a=$a(e,t,async(c,u,d)=>{if(this.fsw.closed||i.depth!==void 0&&fs(c,t)>i.depth)return;let p=r(X.join(e,X.relative(e,c)));if(o&&!o(p))return;let l=X.dirname(p),f=X.basename(p),v=this.fsw._getWatchedDir(d.type===Ge?p:l);if(Ta.has(u)||d.event===_a)if(typeof i.ignored===hs){let y;try{y=await gs(p)}catch{}if(this.fsw.closed||this.checkIgnored(p,y))return;So(d,y)?this.addOrChange(p,c,t,l,v,f,d,i):this.handleEvent(Ct,p,c,t,l,v,f,d,i)}else this.checkExists(p,c,t,l,v,f,d,i);else switch(d.event){case ma:case wa:return this.addOrChange(p,c,t,l,v,f,d,i);case va:case ya:return this.checkExists(p,c,t,l,v,f,d,i)}},this.fsw._emitRaw);return this.fsw._emitReady(),a}async _handleFsEventsSymlink(e,t,r,o){if(!(this.fsw.closed||this.fsw._symlinkPaths.has(t))){this.fsw._symlinkPaths.set(t,!0),this.fsw._incrReadyCount();try{let i=await xo(e);if(this.fsw.closed)return;if(this.fsw._isIgnored(i))return this.fsw._emitReady();this.fsw._incrReadyCount(),this._addToFsEvents(i||e,n=>{let a=e;return i&&i!==Eo?a=n.replace(i,e):n!==Eo&&(a=X.join(e,n)),r(a)},!1,o)}catch(i){if(this.fsw._handleError(i))return this.fsw._emitReady()}}}emitAdd(e,t,r,o,i){let n=r(e),a=t.isDirectory(),c=this.fsw._getWatchedDir(X.dirname(n)),u=X.basename(n);a&&this.fsw._getWatchedDir(n),!c.has(u)&&(c.add(u),(!o.ignoreInitial||i===!0)&&this.fsw._emit(a?Ro:ps,n,t))}initWatch(e,t,r,o){if(this.fsw.closed)return;let i=this._watchWithFsEvents(r.watchPath,X.resolve(e||r.watchPath),o,r.globFilter);this.fsw._addPathCloser(t,i)}async _addToFsEvents(e,t,r,o){if(this.fsw.closed)return;let i=this.fsw.options,n=typeof t===hs?t:Ea,a=this.fsw._getWatchHelpers(e);try{let c=await Pa[a.statMethod](a.watchPath);if(this.fsw.closed)return;if(this.fsw._isIgnored(a.watchPath,c))throw null;if(c.isDirectory()){if(a.globFilter||this.emitAdd(n(e),c,n,i,r),o&&o>i.depth)return;this.fsw._readdirp(a.watchPath,{fileFilter:u=>a.filterPath(u),directoryFilter:u=>a.filterDir(u),...xa(i.depth-(o||0))}).on(fa,u=>{if(this.fsw.closed||u.stats.isDirectory()&&!a.filterPath(u))return;let d=X.join(a.watchPath,u.path),{fullPath:p}=u;if(a.followSymlinks&&u.stats.isSymbolicLink()){let l=i.depth===void 0?void 0:fs(d,X.resolve(a.watchPath))+1;this._handleFsEventsSymlink(d,p,n,l)}else this.emitAdd(d,u.stats,n,i,r)}).on(ha,Ca).on(ga,()=>{this.fsw._emitReady()})}else this.emitAdd(a.watchPath,c,n,i,r),this.fsw._emitReady()}catch(c){(!c||this.fsw._handleError(c))&&(this.fsw._emitReady(),this.fsw._emitReady())}if(i.persistent&&r!==!0)if(typeof t===hs)this.initWatch(void 0,e,a,n);else{let c;try{c=await xo(a.watchPath)}catch{}this.initWatch(c,e,a,n)}}};ys.exports=ms;ys.exports.canUse=Da});var Fs=O(Ds=>{"use strict";var{EventEmitter:Fa}=require("events"),$s=require("fs"),N=require("path"),{promisify:Lo}=require("util"),La=gr(),Es=kr().default,Ha=Pr(),_s=Jt(),Oa=uo(),Na=Xt(),Ba=ko(),To=Ao(),{EV_ALL:bs,EV_READY:ja,EV_ADD:Et,EV_CHANGE:qe,EV_UNLINK:Io,EV_ADD_DIR:Wa,EV_UNLINK_DIR:Ua,EV_RAW:Ga,EV_ERROR:ks,STR_CLOSE:qa,STR_END:za,BACK_SLASH_RE:Ka,DOUBLE_SLASH_RE:$o,SLASH_OR_BACK_SLASH_RE:Va,DOT_RE:Ya,REPLACER_RE:Qa,SLASH:Rs,SLASH_SLASH:Xa,BRACE_START:Za,BANG:xs,ONE_DOT:Ho,TWO_DOTS:Ja,GLOBSTAR:ec,SLASH_GLOBSTAR:Cs,ANYMATCH_OPTS:Ss,STRING_TYPE:Ms,FUNCTION_TYPE:tc,EMPTY_STR:Ps,EMPTY_FN:sc,isWindows:rc,isMacos:oc,isIBMi:nc}=yt(),ic=Lo($s.stat),ac=Lo($s.readdir),As=(s=[])=>Array.isArray(s)?s:[s],Oo=(s,e=[])=>(s.forEach(t=>{Array.isArray(t)?Oo(t,e):e.push(t)}),e),Mo=s=>{let e=Oo(As(s));if(!e.every(t=>typeof t===Ms))throw new TypeError(`Non-string provided as watch path: ${e}`);return e.map(No)},Do=s=>{let e=s.replace(Ka,Rs),t=!1;for(e.startsWith(Xa)&&(t=!0);e.match($o);)e=e.replace($o,Rs);return t&&(e=Rs+e),e},No=s=>Do(N.normalize(Do(s))),Fo=(s=Ps)=>e=>typeof e!==Ms?e:No(N.isAbsolute(e)?e:N.join(s,e)),cc=(s,e)=>N.isAbsolute(s)?s:s.startsWith(xs)?xs+N.join(e,s.slice(1)):N.join(e,s),pe=(s,e)=>s[e]===void 0,Ts=class{constructor(e,t){this.path=e,this._removeWatcher=t,this.items=new Set}add(e){let{items:t}=this;t&&e!==Ho&&e!==Ja&&t.add(e)}async remove(e){let{items:t}=this;if(!t||(t.delete(e),t.size>0))return;let r=this.path;try{await ac(r)}catch{this._removeWatcher&&this._removeWatcher(N.dirname(r),N.basename(r))}}has(e){let{items:t}=this;if(t)return t.has(e)}getChildren(){let{items:e}=this;if(e)return[...e.values()]}dispose(){this.items.clear(),delete this.path,delete this._removeWatcher,delete this.items,Object.freeze(this)}},lc="stat",dc="lstat",Is=class{constructor(e,t,r,o){this.fsw=o,this.path=e=e.replace(Qa,Ps),this.watchPath=t,this.fullWatchPath=N.resolve(t),this.hasGlob=t!==e,e===Ps&&(this.hasGlob=!1),this.globSymlink=this.hasGlob&&r?void 0:!1,this.globFilter=this.hasGlob?Es(e,void 0,Ss):!1,this.dirParts=this.getDirParts(e),this.dirParts.forEach(i=>{i.length>1&&i.pop()}),this.followSymlinks=r,this.statMethod=r?lc:dc}checkGlobSymlink(e){return this.globSymlink===void 0&&(this.globSymlink=e.fullParentDir===this.fullWatchPath?!1:{realPath:e.fullParentDir,linkPath:this.fullWatchPath}),this.globSymlink?e.fullPath.replace(this.globSymlink.realPath,this.globSymlink.linkPath):e.fullPath}entryPath(e){return N.join(this.watchPath,N.relative(this.watchPath,this.checkGlobSymlink(e)))}filterPath(e){let{stats:t}=e;if(t&&t.isSymbolicLink())return this.filterDir(e);let r=this.entryPath(e);return(this.hasGlob&&typeof this.globFilter===tc?this.globFilter(r):!0)&&this.fsw._isntIgnored(r,t)&&this.fsw._hasReadPermissions(t)}getDirParts(e){if(!this.hasGlob)return[];let t=[];return(e.includes(Za)?Oa.expand(e):[e]).forEach(o=>{t.push(N.relative(this.watchPath,o).split(Va))}),t}filterDir(e){if(this.hasGlob){let t=this.getDirParts(this.checkGlobSymlink(e)),r=!1;this.unmatchedGlob=!this.dirParts.some(o=>o.every((i,n)=>(i===ec&&(r=!0),r||!t[0][n]||Es(i,t[0][n],Ss))))}return!this.unmatchedGlob&&this.fsw._isntIgnored(this.entryPath(e),e.stats)}},xt=class extends Fa{constructor(e){super();let t={};e&&Object.assign(t,e),this._watched=new Map,this._closers=new Map,this._ignoredPaths=new Set,this._throttled=new Map,this._symlinkPaths=new Map,this._streams=new Set,this.closed=!1,pe(t,"persistent")&&(t.persistent=!0),pe(t,"ignoreInitial")&&(t.ignoreInitial=!1),pe(t,"ignorePermissionErrors")&&(t.ignorePermissionErrors=!1),pe(t,"interval")&&(t.interval=100),pe(t,"binaryInterval")&&(t.binaryInterval=300),pe(t,"disableGlobbing")&&(t.disableGlobbing=!1),t.enableBinaryInterval=t.binaryInterval!==t.interval,pe(t,"useFsEvents")&&(t.useFsEvents=!t.usePolling),To.canUse()||(t.useFsEvents=!1),pe(t,"usePolling")&&!t.useFsEvents&&(t.usePolling=oc),nc&&(t.usePolling=!0);let o=process.env.CHOKIDAR_USEPOLLING;if(o!==void 0){let c=o.toLowerCase();c==="false"||c==="0"?t.usePolling=!1:c==="true"||c==="1"?t.usePolling=!0:t.usePolling=!!c}let i=process.env.CHOKIDAR_INTERVAL;i&&(t.interval=Number.parseInt(i,10)),pe(t,"atomic")&&(t.atomic=!t.usePolling&&!t.useFsEvents),t.atomic&&(this._pendingUnlinks=new Map),pe(t,"followSymlinks")&&(t.followSymlinks=!0),pe(t,"awaitWriteFinish")&&(t.awaitWriteFinish=!1),t.awaitWriteFinish===!0&&(t.awaitWriteFinish={});let n=t.awaitWriteFinish;n&&(n.stabilityThreshold||(n.stabilityThreshold=2e3),n.pollInterval||(n.pollInterval=100),this._pendingWrites=new Map),t.ignored&&(t.ignored=As(t.ignored));let a=0;this._emitReady=()=>{a++,a>=this._readyCount&&(this._emitReady=sc,this._readyEmitted=!0,process.nextTick(()=>this.emit(ja)))},this._emitRaw=(...c)=>this.emit(Ga,...c),this._readyEmitted=!1,this.options=t,t.useFsEvents?this._fsEventsHandler=new To(this):this._nodeFsHandler=new Ba(this),Object.freeze(t)}add(e,t,r){let{cwd:o,disableGlobbing:i}=this.options;this.closed=!1;let n=Mo(e);return o&&(n=n.map(a=>{let c=cc(a,o);return i||!_s(a)?c:Na(c)})),n=n.filter(a=>a.startsWith(xs)?(this._ignoredPaths.add(a.slice(1)),!1):(this._ignoredPaths.delete(a),this._ignoredPaths.delete(a+Cs),this._userIgnored=void 0,!0)),this.options.useFsEvents&&this._fsEventsHandler?(this._readyCount||(this._readyCount=n.length),this.options.persistent&&(this._readyCount+=n.length),n.forEach(a=>this._fsEventsHandler._addToFsEvents(a))):(this._readyCount||(this._readyCount=0),this._readyCount+=n.length,Promise.all(n.map(async a=>{let c=await this._nodeFsHandler._addToNodeFs(a,!r,0,0,t);return c&&this._emitReady(),c})).then(a=>{this.closed||a.filter(c=>c).forEach(c=>{this.add(N.dirname(c),N.basename(t||c))})})),this}unwatch(e){if(this.closed)return this;let t=Mo(e),{cwd:r}=this.options;return t.forEach(o=>{!N.isAbsolute(o)&&!this._closers.has(o)&&(r&&(o=N.join(r,o)),o=N.resolve(o)),this._closePath(o),this._ignoredPaths.add(o),this._watched.has(o)&&this._ignoredPaths.add(o+Cs),this._userIgnored=void 0}),this}close(){if(this.closed)return this._closePromise;this.closed=!0,this.removeAllListeners();let e=[];return this._closers.forEach(t=>t.forEach(r=>{let o=r();o instanceof Promise&&e.push(o)})),this._streams.forEach(t=>t.destroy()),this._userIgnored=void 0,this._readyCount=0,this._readyEmitted=!1,this._watched.forEach(t=>t.dispose()),["closers","watched","streams","symlinkPaths","throttled"].forEach(t=>{this[`_${t}`].clear()}),this._closePromise=e.length?Promise.all(e).then(()=>{}):Promise.resolve(),this._closePromise}getWatched(){let e={};return this._watched.forEach((t,r)=>{let o=this.options.cwd?N.relative(this.options.cwd,r):r;e[o||Ho]=t.getChildren().sort()}),e}emitWithAll(e,t){this.emit(...t),e!==ks&&this.emit(bs,...t)}async _emit(e,t,r,o,i){if(this.closed)return;let n=this.options;rc&&(t=N.normalize(t)),n.cwd&&(t=N.relative(n.cwd,t));let a=[e,t];i!==void 0?a.push(r,o,i):o!==void 0?a.push(r,o):r!==void 0&&a.push(r);let c=n.awaitWriteFinish,u;if(c&&(u=this._pendingWrites.get(t)))return u.lastChange=new Date,this;if(n.atomic){if(e===Io)return this._pendingUnlinks.set(t,a),setTimeout(()=>{this._pendingUnlinks.forEach((d,p)=>{this.emit(...d),this.emit(bs,...d),this._pendingUnlinks.delete(p)})},typeof n.atomic=="number"?n.atomic:100),this;e===Et&&this._pendingUnlinks.has(t)&&(e=a[0]=qe,this._pendingUnlinks.delete(t))}if(c&&(e===Et||e===qe)&&this._readyEmitted){let d=(p,l)=>{p?(e=a[0]=ks,a[1]=p,this.emitWithAll(e,a)):l&&(a.length>2?a[2]=l:a.push(l),this.emitWithAll(e,a))};return this._awaitWriteFinish(t,c.stabilityThreshold,e,d),this}if(e===qe&&!this._throttle(qe,t,50))return this;if(n.alwaysStat&&r===void 0&&(e===Et||e===Wa||e===qe)){let d=n.cwd?N.join(n.cwd,t):t,p;try{p=await ic(d)}catch{}if(!p||this.closed)return;a.push(p)}return this.emitWithAll(e,a),this}_handleError(e){let t=e&&e.code;return e&&t!=="ENOENT"&&t!=="ENOTDIR"&&(!this.options.ignorePermissionErrors||t!=="EPERM"&&t!=="EACCES")&&this.emit(ks,e),e||this.closed}_throttle(e,t,r){this._throttled.has(e)||this._throttled.set(e,new Map);let o=this._throttled.get(e),i=o.get(t);if(i)return i.count++,!1;let n,a=()=>{let u=o.get(t),d=u?u.count:0;return o.delete(t),clearTimeout(n),u&&clearTimeout(u.timeoutObject),d};n=setTimeout(a,r);let c={timeoutObject:n,clear:a,count:0};return o.set(t,c),c}_incrReadyCount(){return this._readyCount++}_awaitWriteFinish(e,t,r,o){let i,n=e;this.options.cwd&&!N.isAbsolute(e)&&(n=N.join(this.options.cwd,e));let a=new Date,c=u=>{$s.stat(n,(d,p)=>{if(d||!this._pendingWrites.has(e)){d&&d.code!=="ENOENT"&&o(d);return}let l=Number(new Date);u&&p.size!==u.size&&(this._pendingWrites.get(e).lastChange=l);let f=this._pendingWrites.get(e);l-f.lastChange>=t?(this._pendingWrites.delete(e),o(void 0,p)):i=setTimeout(c,this.options.awaitWriteFinish.pollInterval,p)})};this._pendingWrites.has(e)||(this._pendingWrites.set(e,{lastChange:a,cancelWait:()=>(this._pendingWrites.delete(e),clearTimeout(i),r)}),i=setTimeout(c,this.options.awaitWriteFinish.pollInterval))}_getGlobIgnored(){return[...this._ignoredPaths.values()]}_isIgnored(e,t){if(this.options.atomic&&Ya.test(e))return!0;if(!this._userIgnored){let{cwd:r}=this.options,o=this.options.ignored,i=o&&o.map(Fo(r)),n=As(i).filter(c=>typeof c===Ms&&!_s(c)).map(c=>c+Cs),a=this._getGlobIgnored().map(Fo(r)).concat(i,n);this._userIgnored=Es(a,void 0,Ss)}return this._userIgnored([e,t])}_isntIgnored(e,t){return!this._isIgnored(e,t)}_getWatchHelpers(e,t){let r=t||this.options.disableGlobbing||!_s(e)?e:Ha(e),o=this.options.followSymlinks;return new Is(e,r,o,this)}_getWatchedDir(e){this._boundRemove||(this._boundRemove=this._remove.bind(this));let t=N.resolve(e);return this._watched.has(t)||this._watched.set(t,new Ts(t,this._boundRemove)),this._watched.get(t)}_hasReadPermissions(e){if(this.options.ignorePermissionErrors)return!0;let r=(e&&Number.parseInt(e.mode,10))&511;return!!(4&Number.parseInt(r.toString(8)[0],10))}_remove(e,t,r){let o=N.join(e,t),i=N.resolve(o);if(r=r??(this._watched.has(o)||this._watched.has(i)),!this._throttle("remove",o,100))return;!r&&!this.options.useFsEvents&&this._watched.size===1&&this.add(e,t,!0),this._getWatchedDir(o).getChildren().forEach(l=>this._remove(o,l));let c=this._getWatchedDir(e),u=c.has(t);c.remove(t),this._symlinkPaths.has(i)&&this._symlinkPaths.delete(i);let d=o;if(this.options.cwd&&(d=N.relative(this.options.cwd,o)),this.options.awaitWriteFinish&&this._pendingWrites.has(d)&&this._pendingWrites.get(d).cancelWait()===Et)return;this._watched.delete(o),this._watched.delete(i);let p=r?Ua:Io;u&&!this._isIgnored(o)&&this._emit(p,o),this.options.useFsEvents||this._closePath(o)}_closePath(e){this._closeFile(e);let t=N.dirname(e);this._getWatchedDir(t).remove(N.basename(e))}_closeFile(e){let t=this._closers.get(e);t&&(t.forEach(r=>r()),this._closers.delete(e))}_addPathCloser(e,t){if(!t)return;let r=this._closers.get(e);r||(r=[],this._closers.set(e,r)),r.push(t)}_readdirp(e,t){if(this.closed)return;let r={type:bs,alwaysStat:!0,lstat:!0,...t},o=La(e,r);return this._streams.add(o),o.once(qa,()=>{o=void 0}),o.once(za,()=>{o&&(this._streams.delete(o),o=void 0)}),o}};Ds.FSWatcher=xt;var uc=(s,e)=>{let t=new xt(e);return t.add(s),t};Ds.watch=uc});var wc={};Jo(wc,{activate:()=>fc,deactivate:()=>gc});module.exports=en(wc);var h=q(require("vscode"));var z=q(require("vscode")),Ws=q(require("crypto")),it=q(require("path"));function js(s,...e){return z.workspace.getConfiguration("projectMemory").get("showNotifications",!0)?z.window.showInformationMessage(s,...e):Promise.resolve(void 0)}var nt=class{constructor(e,t,r){this._extensionUri=e;this._dataRoot=t,this._agentsRoot=r}static viewType="projectMemory.dashboardView";_view;_dataRoot;_agentsRoot;_disposables=[];dispose(){for(;this._disposables.length;){let e=this._disposables.pop();e&&e.dispose()}}getWorkspaceId(){let e=z.workspace.workspaceFolders?.[0];if(!e)return null;let t=e.uri.fsPath,r=it.normalize(t).toLowerCase(),o=Ws.createHash("sha256").update(r).digest("hex").substring(0,12);return`${it.basename(t).replace(/[^a-zA-Z0-9-_]/g,"-")}-${o}`}resolveWebviewView(e,t,r){this.dispose(),this._view=e,e.webview.options={enableScripts:!0,localResourceRoots:[z.Uri.joinPath(this._extensionUri,"webview","dist"),z.Uri.joinPath(this._extensionUri,"resources")]},e.webview.html=this._getHtmlForWebview(e.webview),this._disposables.push(e.onDidDispose(()=>{this._view=void 0})),this._disposables.push(e.webview.onDidReceiveMessage(async o=>{switch(console.log("Received message from webview:",o),o.type){case"openFile":let{filePath:i,line:n}=o.data;z.commands.executeCommand("projectMemory.openFile",i,n);break;case"runCommand":let{command:a}=o.data;console.log("Executing command:",a);try{await z.commands.executeCommand(a),console.log("Command executed successfully")}catch(R){console.error("Command execution failed:",R),z.window.showErrorMessage(`Command failed: ${R}`)}break;case"openExternal":let{url:c}=o.data;console.log("Opening dashboard panel:",c),z.commands.executeCommand("projectMemory.openDashboardPanel",c);break;case"openPlan":let{planId:u,workspaceId:d}=o.data,p=`http://localhost:5173/workspace/${d}/plan/${u}`;console.log("Opening plan:",p),z.commands.executeCommand("projectMemory.openDashboardPanel",p);break;case"copyToClipboard":let{text:l}=o.data;await z.env.clipboard.writeText(l),js(`Copied to clipboard: ${l}`);break;case"showNotification":let{level:f,text:v}=o.data;f==="error"?z.window.showErrorMessage(v):f==="warning"?z.window.showWarningMessage(v):js(v);break;case"revealInExplorer":let{path:y}=o.data;z.commands.executeCommand("revealInExplorer",z.Uri.file(y));break;case"getConfig":this.postMessage({type:"config",data:{dataRoot:this._dataRoot,agentsRoot:this._agentsRoot,workspaceFolders:z.workspace.workspaceFolders?.map(R=>({name:R.name,path:R.uri.fsPath}))||[]}});break;case"ready":this.postMessage({type:"init",data:{dataRoot:this._dataRoot,agentsRoot:this._agentsRoot}});break}}))}postMessage(e){this._view&&this._view.webview.postMessage(e)}updateConfig(e,t){this._dataRoot=e,this._agentsRoot=t,this.postMessage({type:"configUpdated",data:{dataRoot:e,agentsRoot:t}})}_getHtmlForWebview(e){let t=tn(),r=z.workspace.getConfiguration("projectMemory"),o=r.get("serverPort")||r.get("apiPort")||3001,i="http://localhost:5173",n=this.getWorkspaceId()||"",a=z.workspace.workspaceFolders?.[0]?.name||"No workspace";return`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src 'unsafe-inline'; script-src 'nonce-${t}'; connect-src http://localhost:* ws://localhost:*; frame-src http://localhost:*;">
    <title>Project Memory Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { 
            font-family: var(--vscode-font-family, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif); 
            background: var(--vscode-editor-background, #1e1e1e);
            color: var(--vscode-editor-foreground, #cccccc);
            min-height: 100%;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }
        .header {
            padding: 12px 16px;
            border-bottom: 1px solid var(--vscode-panel-border);
            display: flex;
            align-items: center;
            gap: 8px;
            position: sticky;
            top: 0;
            background: var(--vscode-editor-background);
            z-index: 10;
        }
        .header h2 { font-size: 14px; font-weight: 600; }
        .status { 
            display: flex; 
            align-items: center; 
            gap: 6px;
            margin-left: auto;
            font-size: 12px;
        }
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--vscode-testing-iconPassed);
        }
        .status-dot.error { background: var(--vscode-testing-iconFailed); }
        .status-dot.loading { background: var(--vscode-testing-iconQueued); animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            padding-bottom: 20px;
        }
        .fallback {
            padding: 20px;
            text-align: center;
        }
        .fallback p { margin-bottom: 12px; color: var(--vscode-descriptionForeground); }
        .btn {
            background: var(--vscode-button-background);
            color: var(--vscode-button-foreground);
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            margin: 4px;
        }
        .btn:hover { background: var(--vscode-button-hoverBackground); }
        .btn-secondary {
            background: var(--vscode-button-secondaryBackground);
            color: var(--vscode-button-secondaryForeground);
        }
        .btn-small {
            padding: 4px 8px;
            font-size: 11px;
            margin: 2px;
        }
        
        /* Toast notifications */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--vscode-editor-background);
            border: 1px solid var(--vscode-panel-border);
            border-radius: 6px;
            padding: 10px 16px;
            font-size: 12px;
            z-index: 1000;
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        .toast-success {
            border-color: var(--vscode-testing-iconPassed);
            color: var(--vscode-testing-iconPassed);
        }
        .toast-error {
            border-color: var(--vscode-testing-iconFailed);
            color: var(--vscode-testing-iconFailed);
        }
        
        .info-card {
            background: var(--vscode-editor-inactiveSelectionBackground);
            border-radius: 6px;
            padding: 16px;
            margin: 12px 16px;
        }
        .info-card h3 { font-size: 13px; margin-bottom: 8px; }
        .info-card ul { list-style: none; font-size: 12px; }
        .info-card li { padding: 4px 0; display: flex; gap: 8px; }
        .info-card .label { color: var(--vscode-descriptionForeground); min-width: 80px; }
        
        /* Collapsible sections */
        .collapsible {
            background: var(--vscode-editor-inactiveSelectionBackground);
            border-radius: 6px;
            margin: 8px 16px;
            overflow: hidden;
        }
        .collapsible-header {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            cursor: pointer;
            user-select: none;
            gap: 8px;
        }
        .collapsible-header:hover {
            background: var(--vscode-list-hoverBackground);
        }
        .collapsible-header h3 { font-size: 13px; flex: 1; }
        .collapsible-header .count {
            background: var(--vscode-badge-background);
            color: var(--vscode-badge-foreground);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
        }
        .collapsible-header .chevron {
            transition: transform 0.2s;
        }
        .collapsible.collapsed .chevron { transform: rotate(-90deg); }
        .collapsible-content {
            max-height: 300px;
            overflow-y: auto;
            border-top: 1px solid var(--vscode-panel-border);
        }
        .collapsible.collapsed .collapsible-content { display: none; }
        
        /* Plan items */
        .plan-item {
            display: flex;
            align-items: center;
            padding: 10px 16px;
            gap: 10px;
            border-bottom: 1px solid var(--vscode-panel-border);
        }
        .plan-item:last-child { border-bottom: none; }
        .plan-item:hover { background: var(--vscode-list-hoverBackground); }
        .plan-info { flex: 1; min-width: 0; }
        .plan-title { 
            font-size: 12px; 
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .plan-meta {
            font-size: 10px;
            color: var(--vscode-descriptionForeground);
            display: flex;
            gap: 8px;
            margin-top: 2px;
        }
        .plan-status {
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            text-transform: uppercase;
        }
        .plan-status.active { background: var(--vscode-testing-iconPassed); color: white; }
        .plan-status.archived { background: var(--vscode-descriptionForeground); color: white; }
        .plan-actions { display: flex; gap: 4px; }
        
        .empty-state {
            padding: 20px;
            text-align: center;
            color: var(--vscode-descriptionForeground);
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h2>\u{1F9E0} Project Memory</h2>
        <div class="status">
            <span class="status-dot loading" id="statusDot"></span>
            <span id="statusText">Checking...</span>
        </div>
    </div>
    <div class="content" id="content">
        <div class="fallback" id="fallback">
            <p>Connecting to dashboard server...</p>
        </div>
    </div>
    
    <script nonce="${t}">
        const vscode = acquireVsCodeApi();
        const apiPort = ${o};
        const dashboardUrl = '${i}';
        const workspaceId = '${n}';
        const workspaceName = '${a}';
        
        let activePlans = [];
        let archivedPlans = [];
        
        // Listen for messages from the extension
        window.addEventListener('message', function(event) {
            const message = event.data;
            if (message.type === 'deploymentComplete') {
                const { type, count, targetDir } = message.data;
                showToast('\u2705 Deployed ' + count + ' ' + type + ' to workspace', 'success');
            } else if (message.type === 'deploymentError') {
                showToast('\u274C ' + message.data.error, 'error');
            }
        });
        
        // Toast notification system
        function showToast(message, type) {
            // Remove existing toasts
            const existingToast = document.querySelector('.toast');
            if (existingToast) existingToast.remove();
            
            const toast = document.createElement('div');
            toast.className = 'toast toast-' + type;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            // Animate in
            setTimeout(() => toast.classList.add('show'), 10);
            
            // Remove after 3 seconds
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        // Use event delegation for button clicks (CSP-compliant)
        document.addEventListener('click', function(e) {
            const target = e.target;
            
            // Handle collapsible headers
            if (target.closest('.collapsible-header')) {
                const collapsible = target.closest('.collapsible');
                collapsible.classList.toggle('collapsed');
                return;
            }
            
            if (!target.matches('button')) return;
            
            const action = target.getAttribute('data-action');
            const command = target.getAttribute('data-command');
            const planId = target.getAttribute('data-plan-id');
            const copyText = target.getAttribute('data-copy');
            
            if (action === 'open-browser') {
                vscode.postMessage({ type: 'openExternal', data: { url: dashboardUrl } });
            } else if (action === 'refresh') {
                const statusDot = document.getElementById('statusDot');
                statusDot.className = 'status-dot loading';
                checkServer();
            } else if (action === 'run-command' && command) {
                vscode.postMessage({ type: 'runCommand', data: { command: command } });
            } else if (action === 'open-plan' && planId) {
                vscode.postMessage({ type: 'openPlan', data: { planId: planId, workspaceId: workspaceId } });
            } else if (action === 'copy' && copyText) {
                vscode.postMessage({ type: 'copyToClipboard', data: { text: copyText } });
            }
        });
        
        function renderPlanList(plans, type) {
            if (plans.length === 0) {
                return '<div class="empty-state">No ' + type + ' plans</div>';
            }
            return plans.map(plan => {
                const shortId = plan.id.split('_').pop() || plan.id.substring(0, 8);
                return \`
                    <div class="plan-item">
                        <div class="plan-info">
                            <div class="plan-title" title="\${plan.title}">\${plan.title}</div>
                            <div class="plan-meta">
                                <span>\${plan.category || 'general'}</span>
                                <span>\u2022</span>
                                <span>\${plan.progress?.done || 0}/\${plan.progress?.total || 0} steps</span>
                            </div>
                        </div>
                        <span class="plan-status \${plan.status}">\${plan.status}</span>
                        <div class="plan-actions">
                            <button class="btn btn-small btn-secondary" data-action="copy" data-copy="\${plan.id}" title="Copy plan ID">\u{1F4CB}</button>
                            <button class="btn btn-small" data-action="open-plan" data-plan-id="\${plan.id}" title="Open plan">\u2192</button>
                        </div>
                    </div>
                \`;
            }).join('');
        }
        
        async function fetchPlans() {
            if (!workspaceId) {
                console.log('No workspaceId, skipping plan fetch');
                return;
            }
            console.log('Fetching plans for workspace:', workspaceId);
            try {
                const response = await fetch('http://localhost:' + apiPort + '/api/plans/workspace/' + workspaceId);
                console.log('Plans response status:', response.status);
                if (response.ok) {
                    const data = await response.json();
                    console.log('Plans data:', data);
                    activePlans = (data.plans || []).filter(p => p.status === 'active');
                    archivedPlans = (data.plans || []).filter(p => p.status === 'archived');
                    updatePlanLists();
                }
            } catch (error) {
                console.log('Failed to fetch plans:', error);
            }
        }
        
        function updatePlanLists() {
            const activeList = document.getElementById('activePlansList');
            const archivedList = document.getElementById('archivedPlansList');
            const activeCount = document.getElementById('activeCount');
            const archivedCount = document.getElementById('archivedCount');
            
            if (activeList) activeList.innerHTML = renderPlanList(activePlans, 'active');
            if (archivedList) archivedList.innerHTML = renderPlanList(archivedPlans, 'archived');
            if (activeCount) activeCount.textContent = activePlans.length;
            if (archivedCount) archivedCount.textContent = archivedPlans.length;
        }
        
        async function checkServer() {
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            const content = document.getElementById('content');
            const fallback = document.getElementById('fallback');
            
            try {
                const response = await fetch('http://localhost:' + apiPort + '/api/health');
                if (response.ok) {
                    const data = await response.json();
                    statusDot.className = 'status-dot';
                    statusText.textContent = 'Connected';
                    
                    // Show dashboard info with plan lists
                    fallback.innerHTML = \`
                        <div class="info-card">
                            <h3>\u{1F4CA} Server Status</h3>
                            <ul>
                                <li><span class="label">Status:</span> <span>\u2713 Running</span></li>
                                <li><span class="label">API Port:</span> <span>\${apiPort}</span></li>
                                <li><span class="label">Workspace:</span> <span>\${workspaceName}</span></li>
                            </ul>
                        </div>
                        <div style="padding: 8px 16px; display: flex; gap: 8px;">
                            <button class="btn" style="flex:1" data-action="open-browser">Open Full Dashboard</button>
                            <button class="btn btn-secondary" data-action="refresh">\u21BB</button>
                        </div>
                        <div class="info-card">
                            <h3>\u26A1 Quick Actions</h3>
                            <ul>
                                <li><button class="btn btn-secondary" style="width:100%" data-action="run-command" data-command="projectMemory.createPlan">Create New Plan</button></li>
                                <li><button class="btn btn-secondary" style="width:100%" data-action="run-command" data-command="projectMemory.deployAgents">Deploy Agents</button></li>
                                <li><button class="btn btn-secondary" style="width:100%" data-action="run-command" data-command="projectMemory.deployInstructions">Deploy Instructions</button></li>
                                <li><button class="btn btn-secondary" style="width:100%" data-action="run-command" data-command="projectMemory.deployPrompts">Deploy Prompts</button></li>
                            </ul>
                        </div>
                        
                        <div class="info-card">
                            <h3>\u2699\uFE0F Configuration</h3>
                            <ul>
                                <li><button class="btn btn-secondary" style="width:100%" data-action="run-command" data-command="projectMemory.openSettings">Configure Defaults</button></li>
                                <li><button class="btn btn-secondary" style="width:100%" data-action="run-command" data-command="projectMemory.deployDefaults">Deploy All Defaults</button></li>
                            </ul>
                        </div>
                        
                        <div class="collapsible" id="activePlansSection">
                            <div class="collapsible-header">
                                <span class="chevron">\u25BC</span>
                                <h3>\u{1F4CB} Active Plans</h3>
                                <span class="count" id="activeCount">0</span>
                            </div>
                            <div class="collapsible-content" id="activePlansList">
                                <div class="empty-state">Loading...</div>
                            </div>
                        </div>
                        
                        <div class="collapsible collapsed" id="archivedPlansSection">
                            <div class="collapsible-header">
                                <span class="chevron">\u25BC</span>
                                <h3>\u{1F4E6} Archived Plans</h3>
                                <span class="count" id="archivedCount">0</span>
                            </div>
                            <div class="collapsible-content" id="archivedPlansList">
                                <div class="empty-state">Loading...</div>
                            </div>
                        </div>
                    \`;
                    
                    // Fetch plans after rendering
                    fetchPlans();
                } else {
                    throw new Error('Server returned ' + response.status);
                }
            } catch (error) {
                statusDot.className = 'status-dot error';
                statusText.textContent = 'Disconnected';
                fallback.innerHTML = \`
                    <p>Dashboard server is not running</p>
                    <button class="btn" data-action="run-command" data-command="projectMemory.startServer">Start Server</button>
                    <button class="btn btn-secondary" data-action="refresh">Retry</button>
                    <div class="info-card" style="margin-top: 20px;">
                        <h3>\u{1F4A1} Troubleshooting</h3>
                        <ul>
                            <li>Check if port \${apiPort} is available</li>
                            <li>View server logs for errors</li>
                            <li>Try restarting the server</li>
                        </ul>
                        <button class="btn btn-secondary" style="margin-top: 12px" data-action="run-command" data-command="projectMemory.showServerLogs">Show Server Logs</button>
                    </div>
                \`;
            }
        }
        
        // Initial check
        checkServer();
        
        // Periodic check every 30 seconds (reduced from 10 for performance)
        setInterval(checkServer, 30000);
        
        // Signal ready
        vscode.postMessage({ type: 'ready' });
    </script>
</body>
</html>`}};function tn(){let s="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let t=0;t<32;t++)s+=e.charAt(Math.floor(Math.random()*e.length));return s}var Ie=q(require("vscode")),Bo=q(Fs()),ze=q(require("path"));function Ls(s,...e){return Ie.workspace.getConfiguration("projectMemory").get("showNotifications",!0)?Ie.window.showInformationMessage(s,...e):Promise.resolve(void 0)}var St=class{watcher=null;agentsRoot;autoDeploy;constructor(e,t){this.agentsRoot=e,this.autoDeploy=t}start(){if(this.watcher)return;let e=ze.join(this.agentsRoot,"*.agent.md");this.watcher=Bo.watch(e,{persistent:!0,ignoreInitial:!0}),this.watcher.on("change",async t=>{let r=ze.basename(t,".agent.md");this.autoDeploy?Ls(`Deploying updated agent: ${r}`):await Ls(`Agent template updated: ${r}`,"Deploy to All Workspaces","Ignore")==="Deploy to All Workspaces"&&Ie.commands.executeCommand("projectMemory.deployAgents")}),this.watcher.on("add",t=>{let r=ze.basename(t,".agent.md");Ls(`New agent template detected: ${r}`)}),console.log(`Agent watcher started for: ${e}`)}stop(){this.watcher&&(this.watcher.close(),this.watcher=null,console.log("Agent watcher stopped"))}setAutoDeploy(e){this.autoDeploy=e}};var Re=q(require("vscode")),jo=q(Fs()),At=q(require("path"));function Hs(s,...e){return Re.workspace.getConfiguration("projectMemory").get("showNotifications",!0)?Re.window.showInformationMessage(s,...e):Promise.resolve(void 0)}var Pt=class{watchers=new Map;config;onFileChange;constructor(e){this.config=e}start(){this.config.agentsRoot&&this.startWatcher("agent",this.config.agentsRoot,"*.agent.md"),this.config.promptsRoot&&this.startWatcher("prompt",this.config.promptsRoot,"*.prompt.md"),this.config.instructionsRoot&&this.startWatcher("instruction",this.config.instructionsRoot,"*.instructions.md")}startWatcher(e,t,r){if(this.watchers.has(e))return;let o=At.join(t,r),i=jo.watch(o,{persistent:!0,ignoreInitial:!0});i.on("change",async n=>{this.handleFileEvent(e,n,"change")}),i.on("add",n=>{this.handleFileEvent(e,n,"add")}),i.on("unlink",n=>{this.handleFileEvent(e,n,"unlink")}),this.watchers.set(e,i),console.log(`${e} watcher started for: ${o}`)}async handleFileEvent(e,t,r){let o=At.basename(t),n={agent:"Agent template",prompt:"Prompt file",instruction:"Instruction file"}[e];if(this.onFileChange&&this.onFileChange(e,t,r),r==="unlink"){Re.window.showWarningMessage(`${n} deleted: ${o}`);return}if(r==="add"){Hs(`New ${n.toLowerCase()} detected: ${o}`);return}this.config.autoDeploy?(Hs(`Auto-deploying updated ${n.toLowerCase()}: ${o}`),this.triggerDeploy(e)):await Hs(`${n} updated: ${o}`,"Deploy to All Workspaces","Ignore")==="Deploy to All Workspaces"&&this.triggerDeploy(e)}triggerDeploy(e){let t={agent:"projectMemory.deployAgents",prompt:"projectMemory.deployPrompts",instruction:"projectMemory.deployInstructions"};Re.commands.executeCommand(t[e])}stop(){for(let[e,t]of this.watchers)t.close(),console.log(`${e} watcher stopped`);this.watchers.clear()}updateConfig(e){this.stop(),this.config={...this.config,...e},this.start()}setAutoDeploy(e){this.config.autoDeploy=e}onFileChanged(e){this.onFileChange=e}getWatchedPaths(){let e=[];return this.config.agentsRoot&&e.push({type:"agent",path:this.config.agentsRoot}),this.config.promptsRoot&&e.push({type:"prompt",path:this.config.promptsRoot}),this.config.instructionsRoot&&e.push({type:"instruction",path:this.config.instructionsRoot}),e}};var It=q(require("vscode")),Tt=class{statusBarItem;currentAgent=null;currentPlan=null;constructor(){this.statusBarItem=It.window.createStatusBarItem(It.StatusBarAlignment.Left,100),this.statusBarItem.command="projectMemory.showDashboard",this.updateDisplay(),this.statusBarItem.show()}setCurrentAgent(e){this.currentAgent=e,this.updateDisplay()}setCurrentPlan(e){this.currentPlan=e,this.updateDisplay()}updateDisplay(){this.currentAgent&&this.currentPlan?(this.statusBarItem.text=`$(robot) ${this.currentAgent} \xB7 ${this.currentPlan}`,this.statusBarItem.tooltip=`Project Memory: ${this.currentAgent} working on "${this.currentPlan}"`):this.currentAgent?(this.statusBarItem.text=`$(robot) ${this.currentAgent}`,this.statusBarItem.tooltip=`Project Memory: ${this.currentAgent} active`):(this.statusBarItem.text="$(robot) Project Memory",this.statusBarItem.tooltip="Click to open Project Memory Dashboard")}showTemporaryMessage(e,t=3e3){let r=this.statusBarItem.text,o=this.statusBarItem.tooltip;this.statusBarItem.text=`$(sync~spin) ${e}`,this.statusBarItem.tooltip=e,setTimeout(()=>{this.statusBarItem.text=r,this.statusBarItem.tooltip=o},t)}setCopilotStatus(e){e.agents+e.prompts+e.instructions>0?(this.statusBarItem.text=`$(robot) PM (${e.agents}A/${e.prompts}P/${e.instructions}I)`,this.statusBarItem.tooltip=`Project Memory
Agents: ${e.agents}
Prompts: ${e.prompts}
Instructions: ${e.instructions}`):this.updateDisplay()}dispose(){this.statusBarItem.dispose()}};var Z=q(require("vscode")),Ke=require("child_process"),me=q(require("path")),Os=q(require("http"));function pc(s,...e){return Z.workspace.getConfiguration("projectMemory").get("showNotifications",!0)?Z.window.showInformationMessage(s,...e):Promise.resolve(void 0)}var $t=class{serverProcess=null;frontendProcess=null;outputChannel;statusBarItem;_isRunning=!1;_isFrontendRunning=!1;_isExternalServer=!1;_isExternalFrontend=!1;config;restartAttempts=0;maxRestartAttempts=3;_performanceStats={apiCalls:0,avgResponseTime:0,lastCheck:Date.now()};constructor(e){this.config=e,this.outputChannel=Z.window.createOutputChannel("Project Memory Server"),this.statusBarItem=Z.window.createStatusBarItem(Z.StatusBarAlignment.Right,100),this.statusBarItem.command="projectMemory.toggleServer"}get isRunning(){return this._isRunning}get isFrontendRunning(){return this._isFrontendRunning}get isExternalServer(){return this._isExternalServer}get performanceStats(){return{...this._performanceStats}}async start(){if(this._isRunning)return this.log("Server is already running"),!0;let e=this.config.serverPort||3001;if(this.log(`Checking if server already exists on port ${e}...`),await this.checkHealth(e))return this.log("Found existing server - connecting without spawning new process"),this._isRunning=!0,this._isExternalServer=!0,this.restartAttempts=0,this.updateStatusBar("connected"),pc("Connected to existing Project Memory server"),!0;let r=this.getServerDirectory();if(!r)return this.log("Dashboard server directory not found"),!1;this.log(`Starting server from: ${r}`),this._isExternalServer=!1,this.updateStatusBar("starting");try{let o={...process.env,PORT:String(this.config.serverPort||3001),WS_PORT:String(this.config.wsPort||3002),MBS_DATA_ROOT:this.config.dataRoot,MBS_AGENTS_ROOT:this.config.agentsRoot,MBS_PROMPTS_ROOT:this.config.promptsRoot||"",MBS_INSTRUCTIONS_ROOT:this.config.instructionsRoot||""},i=me.join(r,"dist","index.js"),n,a;return require("fs").existsSync(i)?(n="node",a=[i]):(n=process.platform==="win32"?"npx.cmd":"npx",a=["tsx","src/index.ts"]),this.serverProcess=(0,Ke.spawn)(n,a,{cwd:r,env:o,shell:!0,windowsHide:!0}),this.serverProcess.stdout?.on("data",d=>{this.log(d.toString().trim())}),this.serverProcess.stderr?.on("data",d=>{this.log(`[stderr] ${d.toString().trim()}`)}),this.serverProcess.on("error",d=>{this.log(`Server error: ${d.message}`),this._isRunning=!1,this.updateStatusBar("error")}),this.serverProcess.on("exit",(d,p)=>{this.log(`Server exited with code ${d}, signal ${p}`),this._isRunning=!1,this.serverProcess=null,d!==0&&this.restartAttempts<this.maxRestartAttempts?(this.restartAttempts++,this.log(`Attempting restart (${this.restartAttempts}/${this.maxRestartAttempts})...`),setTimeout(()=>this.start(),2e3)):this.updateStatusBar("stopped")}),await this.waitForServer(1e4)?(this._isRunning=!0,this.restartAttempts=0,this.updateStatusBar("running"),this.log("Server started successfully"),!0):(this.log("Server failed to start within timeout"),this.stop(),!1)}catch(o){return this.log(`Failed to start server: ${o}`),this.updateStatusBar("error"),!1}}async stop(){if(this._isExternalServer){this.log("Disconnecting from external server (not stopping it)"),this._isRunning=!1,this._isExternalServer=!1,this.updateStatusBar("stopped");return}if(this.serverProcess)return this.log("Stopping server..."),this.updateStatusBar("stopping"),new Promise(e=>{if(!this.serverProcess){e();return}let t=setTimeout(()=>{this.serverProcess&&(this.log("Force killing server..."),this.serverProcess.kill("SIGKILL")),e()},5e3);this.serverProcess.on("exit",()=>{clearTimeout(t),this._isRunning=!1,this.serverProcess=null,this.updateStatusBar("stopped"),this.log("Server stopped"),e()}),process.platform==="win32"?(0,Ke.spawn)("taskkill",["/pid",String(this.serverProcess.pid),"/f","/t"],{windowsHide:!0}):this.serverProcess.kill("SIGTERM")})}async restart(){return await this.stop(),this.start()}async startFrontend(){if(this._isFrontendRunning)return this.log("Frontend is already running"),!0;if(await this.checkPort(5173))return this.log("Found existing frontend on port 5173 - using it"),this._isFrontendRunning=!0,this._isExternalFrontend=!0,!0;let t=this.getDashboardDirectory();if(!t)return this.log("Could not find dashboard directory for frontend"),!1;this.log(`Starting frontend from: ${t}`);try{let r=process.platform==="win32"?"npm.cmd":"npm",o=["run","dev"];return this.frontendProcess=(0,Ke.spawn)(r,o,{cwd:t,shell:!0,windowsHide:!0,env:{...process.env,VITE_API_URL:`http://localhost:${this.config.serverPort||3001}`}}),this.frontendProcess.stdout?.on("data",n=>{this.log(`[frontend] ${n.toString().trim()}`)}),this.frontendProcess.stderr?.on("data",n=>{this.log(`[frontend] ${n.toString().trim()}`)}),this.frontendProcess.on("error",n=>{this.log(`Frontend error: ${n.message}`),this._isFrontendRunning=!1}),this.frontendProcess.on("exit",(n,a)=>{this.log(`Frontend exited with code ${n}, signal ${a}`),this._isFrontendRunning=!1,this.frontendProcess=null}),await this.waitForPort(5173,15e3)?(this._isFrontendRunning=!0,this.log("Frontend started successfully on port 5173"),!0):(this.log("Frontend failed to start within timeout"),!1)}catch(r){return this.log(`Failed to start frontend: ${r}`),!1}}async stopFrontend(){if(this._isExternalFrontend){this.log("Disconnecting from external frontend (not stopping it)"),this._isFrontendRunning=!1,this._isExternalFrontend=!1;return}if(this.frontendProcess)return this.log("Stopping frontend..."),new Promise(e=>{if(!this.frontendProcess){e();return}let t=setTimeout(()=>{this.frontendProcess&&(this.log("Force killing frontend..."),this.frontendProcess.kill("SIGKILL")),e()},5e3);this.frontendProcess.on("exit",()=>{clearTimeout(t),this._isFrontendRunning=!1,this.frontendProcess=null,this.log("Frontend stopped"),e()}),process.platform==="win32"?(0,Ke.spawn)("taskkill",["/pid",String(this.frontendProcess.pid),"/f","/t"],{windowsHide:!0}):this.frontendProcess.kill("SIGTERM")})}getDashboardDirectory(){let e=Z.workspace.workspaceFolders?.[0]?.uri.fsPath,t=Z.extensions.getExtension("project-memory.project-memory-dashboard")?.extensionPath,r=[t?me.join(t,"dashboard"):null,"c:\\Users\\codi.f\\vscode_ModularAgenticProcedureSystem\\dashboard","c:\\Users\\User\\Project_Memory_MCP\\Project-Memory-MCP\\dashboard",e?me.join(e,"dashboard"):null,t?me.join(t,"..","dashboard"):null].filter(Boolean),o=require("fs");for(let i of r){let n=me.join(i,"package.json");if(o.existsSync(n))return this.log(`Found dashboard at: ${i}`),i}return this.log("Could not find dashboard directory for frontend"),null}async waitForPort(e,t){let r=Date.now();for(;Date.now()-r<t;){try{if(await this.checkPort(e))return!0}catch{}await new Promise(o=>setTimeout(o,500))}return!1}checkPort(e){return new Promise(t=>{let r=Os.get(`http://localhost:${e}`,o=>{t(o.statusCode!==void 0)});r.on("error",()=>t(!1)),r.setTimeout(1e3,()=>{r.destroy(),t(!1)})})}updateConfig(e){this.config={...this.config,...e},this._isRunning&&this.restart()}getServerDirectory(){let e=Z.extensions.getExtension("project-memory.project-memory-dashboard")?.extensionPath,t=Z.workspace.workspaceFolders?.[0]?.uri.fsPath,r=[e?me.join(e,"server"):null,"c:\\Users\\codi.f\\vscode_ModularAgenticProcedureSystem\\dashboard\\server","c:\\Users\\User\\Project_Memory_MCP\\Project-Memory-MCP\\dashboard\\server",t?me.join(t,"dashboard","server"):null,e?me.join(e,"..","dashboard","server"):null].filter(Boolean),o=require("fs");for(let i of r){let n=me.join(i,"package.json");if(o.existsSync(n))return this.log(`Found server at: ${i}`),i}return null}hasServerDirectory(){return this.getServerDirectory()!==null}async waitForServer(e){let t=this.config.serverPort||3001,r=Date.now();for(;Date.now()-r<e;){try{if(await this.checkHealth(t))return!0}catch{}await new Promise(o=>setTimeout(o,500))}return!1}checkHealth(e){return new Promise(t=>{let r=Os.get(`http://localhost:${e}/api/health`,o=>{t(o.statusCode===200)});r.on("error",()=>t(!1)),r.setTimeout(1e3,()=>{r.destroy(),t(!1)})})}updateStatusBar(e){let t={starting:"$(loading~spin)",running:"$(check)",connected:"$(plug)",stopping:"$(loading~spin)",stopped:"$(circle-slash)",error:"$(error)"},r={running:new Z.ThemeColor("statusBarItem.prominentBackground"),connected:new Z.ThemeColor("statusBarItem.prominentBackground"),error:new Z.ThemeColor("statusBarItem.errorBackground")},o={starting:"PM Server",running:"PM Server (local)",connected:"PM Server (shared)",stopping:"PM Server",stopped:"PM Server",error:"PM Server"};this.statusBarItem.text=`${t[e]} ${o[e]||"PM Server"}`,this.statusBarItem.tooltip=`Project Memory Server: ${e}${this._isExternalServer?" (connected to existing)":""}
Click to toggle`,this.statusBarItem.backgroundColor=r[e],this.statusBarItem.show()}async measureApiCall(e){let t=Date.now();try{let r=await e(),o=Date.now()-t;return this._performanceStats.apiCalls++,this._performanceStats.avgResponseTime=(this._performanceStats.avgResponseTime*(this._performanceStats.apiCalls-1)+o)/this._performanceStats.apiCalls,this._performanceStats.lastCheck=Date.now(),r}catch(r){throw r}}log(e){let t=new Date().toISOString();this.outputChannel.appendLine(`[${t}] ${e}`)}showLogs(){this.outputChannel.show()}dispose(){this.stop(),this.stopFrontend(),this.outputChannel.dispose(),this.statusBarItem.dispose()}};var Wo=q(require("vscode")),Y=q(require("fs")),J=q(require("path")),Mt=class{outputChannel;config;constructor(e){this.config=e,this.outputChannel=Wo.window.createOutputChannel("Project Memory Deployment")}updateConfig(e){this.config={...this.config,...e}}async deployToWorkspace(e){let t=[],r=[];this.log(`Deploying defaults to workspace: ${e}`);let o=J.join(e,".github","agents");for(let n of this.config.defaultAgents)try{await this.deployAgent(n,o)&&t.push(n)}catch(a){this.log(`Failed to deploy agent ${n}: ${a}`)}let i=J.join(e,".github","instructions");for(let n of this.config.defaultInstructions)try{await this.deployInstruction(n,i)&&r.push(n)}catch(a){this.log(`Failed to deploy instruction ${n}: ${a}`)}return this.log(`Deployed ${t.length} agents, ${r.length} instructions`),{agents:t,instructions:r}}async deployAgent(e,t){let r=J.join(this.config.agentsRoot,`${e}.agent.md`),o=J.join(t,`${e}.agent.md`);return this.copyFile(r,o)}async deployInstruction(e,t){let r=J.join(this.config.instructionsRoot,`${e}.instructions.md`),o=J.join(t,`${e}.instructions.md`);return this.copyFile(r,o)}async updateWorkspace(e){let t=[],r=[],o=J.join(e,".github","agents"),i=J.join(e,".github","instructions");for(let n of this.config.defaultAgents){let a=J.join(this.config.agentsRoot,`${n}.agent.md`),c=J.join(o,`${n}.agent.md`);if(Y.existsSync(a))if(Y.existsSync(c)){let u=Y.statSync(a),d=Y.statSync(c);u.mtimeMs>d.mtimeMs&&(await this.copyFile(a,c,!0),t.push(n))}else await this.copyFile(a,c),r.push(n)}for(let n of this.config.defaultInstructions){let a=J.join(this.config.instructionsRoot,`${n}.instructions.md`),c=J.join(i,`${n}.instructions.md`);if(Y.existsSync(a))if(Y.existsSync(c)){let u=Y.statSync(a),d=Y.statSync(c);u.mtimeMs>d.mtimeMs&&(await this.copyFile(a,c,!0),t.push(n))}else await this.copyFile(a,c),r.push(n)}return{updated:t,added:r}}getDeploymentPlan(){let e=this.config.defaultAgents.filter(r=>{let o=J.join(this.config.agentsRoot,`${r}.agent.md`);return Y.existsSync(o)}),t=this.config.defaultInstructions.filter(r=>{let o=J.join(this.config.instructionsRoot,`${r}.instructions.md`);return Y.existsSync(o)});return{agents:e,instructions:t}}async copyFile(e,t,r=!1){if(!Y.existsSync(e))return this.log(`Source not found: ${e}`),!1;if(Y.existsSync(t)&&!r)return this.log(`Target exists, skipping: ${t}`),!1;let o=J.dirname(t);return Y.existsSync(o)||Y.mkdirSync(o,{recursive:!0}),Y.copyFileSync(e,t),this.log(`Copied: ${e} -> ${t}`),!0}log(e){let t=new Date().toISOString();this.outputChannel.appendLine(`[${t}] ${e}`)}showLogs(){this.outputChannel.show()}dispose(){this.outputChannel.dispose()}};var de=q(require("vscode")),Dt=class s{static currentPanel;_panel;_disposables=[];static viewType="projectMemory.dashboard";constructor(e,t,r){this._panel=e,this._update(r),this._panel.onDidDispose(()=>this.dispose(),null,this._disposables),this._panel.webview.onDidReceiveMessage(o=>{o.type==="alert"&&de.window.showInformationMessage(o.text)},null,this._disposables)}static createOrShow(e,t){let r=de.window.activeTextEditor?de.window.activeTextEditor.viewColumn:void 0;if(s.currentPanel){s.currentPanel._panel.reveal(r),s.currentPanel._update(t);return}let o=de.window.createWebviewPanel(s.viewType,"\u{1F9E0} PMD",r||de.ViewColumn.One,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[e]});s.currentPanel=new s(o,e,t)}static revive(e,t,r){s.currentPanel=new s(e,t,r)}_update(e){let t=this._panel.webview;this._panel.title="\u{1F9E0} PMD",this._panel.iconPath={light:de.Uri.joinPath(de.Uri.file(__dirname),"..","resources","icon.svg"),dark:de.Uri.joinPath(de.Uri.file(__dirname),"..","resources","icon.svg")},t.html=this._getHtmlForWebview(t,e)}_getHtmlForWebview(e,t){let r=hc();return`<!DOCTYPE html>
<html lang="en" style="height: 100%; margin: 0; padding: 0;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; frame-src ${t} http://localhost:*; style-src 'unsafe-inline';">
    <title>Project Memory Dashboard</title>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            font-family: var(--vscode-font-family);
            color: var(--vscode-foreground);
            background: var(--vscode-editor-background);
        }
        .error {
            text-align: center;
            padding: 20px;
        }
        .error h2 {
            color: var(--vscode-errorForeground);
        }
        .error button {
            margin-top: 16px;
            padding: 8px 16px;
            background: var(--vscode-button-background);
            color: var(--vscode-button-foreground);
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .error button:hover {
            background: var(--vscode-button-hoverBackground);
        }
    </style>
</head>
<body>
    <iframe 
        id="dashboard-frame"
        src="${t}"
        title="Project Memory Dashboard"
        sandbox="allow-scripts allow-same-origin allow-forms allow-popups"
    ></iframe>
    
    <script nonce="${r}">
        (function() {
            const iframe = document.getElementById('dashboard-frame');
            if (iframe) {
                iframe.onerror = function() {
                    document.body.innerHTML = \`
                        <div class="error">
                            <h2>Unable to load dashboard</h2>
                            <p>Make sure the dashboard server is running on ${t}</p>
                            <button onclick="location.reload()">Retry</button>
                        </div>
                    \`;
                };
            }
        })();
    </script>
</body>
</html>`}dispose(){for(s.currentPanel=void 0,this._panel.dispose();this._disposables.length;){let e=this._disposables.pop();e&&e.dispose()}}};function hc(){let s="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let t=0;t<32;t++)s+=e.charAt(Math.floor(Math.random()*e.length));return s}var $e=q(require("vscode")),Ft=q(require("http")),Uo=q(require("crypto")),Ve=class{connected=!1;serverPort=3001;serverHost="localhost";outputChannel;reconnectAttempts=0;maxReconnectAttempts=3;reconnectDelay=1e3;config;_onConnectionChange=new $e.EventEmitter;onConnectionChange=this._onConnectionChange.event;constructor(e){this.config=e,this.outputChannel=$e.window.createOutputChannel("Project Memory MCP Bridge");let t=$e.workspace.getConfiguration("projectMemory");this.serverPort=t.get("serverPort")||3001}async connect(){if(this.connected){this.log("Already connected");return}try{let e=await this.httpGet("/api/health");if(e.status==="ok")this.connected=!0,this.reconnectAttempts=0,this._onConnectionChange.fire(!0),this.log(`Connected to shared server at localhost:${this.serverPort}`),this.log(`Data root: ${e.dataRoot}`);else throw new Error("Server health check failed")}catch(e){throw this.log(`Connection failed: ${e}`),this.connected=!1,this._onConnectionChange.fire(!1),new Error(`Could not connect to Project Memory server.
Please ensure the server is running (check PM Server status bar item).`)}}async disconnect(){this.connected&&(this.connected=!1,this._onConnectionChange.fire(!1),this.log("Disconnected from server"))}isConnected(){return this.connected}async reconnect(){this.connected=!1,this._onConnectionChange.fire(!1),await this.connect()}async callTool(e,t){if(!this.connected)throw new Error("Not connected to Project Memory server");this.log(`Calling tool: ${e} with args: ${JSON.stringify(t)}`);try{let r=await this.mapToolToHttp(e,t);return this.log(`Tool ${e} result: ${JSON.stringify(r).substring(0,200)}...`),r}catch(r){throw this.log(`Tool ${e} error: ${r}`),r}}async mapToolToHttp(e,t){switch(e){case"register_workspace":return this.registerWorkspace(t.workspace_path);case"get_workspace_info":return this.httpGet(`/api/workspaces/${t.workspace_id}`);case"list_workspaces":return this.httpGet("/api/workspaces");case"create_plan":return this.httpPost(`/api/plans/${t.workspace_id}`,{title:t.title,description:t.description,category:t.category||"feature",priority:t.priority||"medium"});case"get_plan_state":return this.httpGet(`/api/plans/${t.workspace_id}/${t.plan_id}`);case"list_plans":let r=await this.httpGet(`/api/plans/workspace/${t.workspace_id}`);return{active_plans:r.plans,total:r.total};case"update_step":return this.httpPut(`/api/plans/${t.workspace_id}/${t.plan_id}/steps/${t.step_id}`,{status:t.status,notes:t.notes});case"append_steps":return this.httpPost(`/api/plans/${t.workspace_id}/${t.plan_id}/steps`,{steps:t.steps});case"add_note":return this.httpPost(`/api/plans/${t.workspace_id}/${t.plan_id}/notes`,{note:t.note,type:t.type||"info"});case"handoff":return this.httpPost(`/api/plans/${t.workspace_id}/${t.plan_id}/handoff`,{from_agent:t.from_agent,to_agent:t.to_agent,summary:t.summary,artifacts:t.artifacts});case"get_lineage":return this.httpGet(`/api/plans/${t.workspace_id}/${t.plan_id}/lineage`);case"store_context":return this.httpPost(`/api/plans/${t.workspace_id}/${t.plan_id}/context`,{type:t.type,data:t.data});case"get_context":return this.httpGet(`/api/plans/${t.workspace_id}/${t.plan_id}/context/${t.type}`);case"initialise_agent":return this.httpPost("/api/agents/initialise",t);case"complete_agent":return this.httpPost("/api/agents/complete",t);case"search":return this.httpGet(`/api/search?q=${encodeURIComponent(t.query)}`);default:throw new Error(`Unknown tool: ${e}`)}}async registerWorkspace(e){let r=(await this.httpGet("/api/workspaces")).workspaces.find(i=>i.path?.toLowerCase()===e.toLowerCase());return r?{workspace:{workspace_id:r.id}}:{workspace:{workspace_id:this.pathToWorkspaceId(e)}}}pathToWorkspaceId(e){let t=e.split(/[/\\]/).filter(Boolean).pop()||"workspace",r=Uo.createHash("sha256").update(e).digest("hex").substring(0,12);return`${t}-${r}`}async listTools(){return[{name:"register_workspace",description:"Register a workspace"},{name:"list_workspaces",description:"List all workspaces"},{name:"get_workspace_info",description:"Get workspace details"},{name:"create_plan",description:"Create a new plan"},{name:"get_plan_state",description:"Get plan state"},{name:"list_plans",description:"List plans for a workspace"},{name:"update_step",description:"Update a plan step"},{name:"append_steps",description:"Add steps to a plan"},{name:"add_note",description:"Add a note to a plan"},{name:"handoff",description:"Hand off between agents"},{name:"get_lineage",description:"Get handoff lineage"},{name:"store_context",description:"Store context data"},{name:"get_context",description:"Get context data"},{name:"initialise_agent",description:"Initialize an agent session"},{name:"complete_agent",description:"Complete an agent session"},{name:"search",description:"Search across workspaces"}]}showLogs(){this.outputChannel.show()}dispose(){this.disconnect(),this._onConnectionChange.dispose(),this.outputChannel.dispose()}log(e){let t=new Date().toISOString();this.outputChannel.appendLine(`[${t}] ${e}`),console.log(`[MCP Bridge] ${e}`)}httpGet(e){return new Promise((t,r)=>{let o=`http://${this.serverHost}:${this.serverPort}${e}`;this.log(`GET ${o}`);let i=Ft.get(o,n=>{let a="";n.on("data",c=>a+=c),n.on("end",()=>{try{if(n.statusCode&&n.statusCode>=400){r(new Error(`HTTP ${n.statusCode}: ${a}`));return}let c=JSON.parse(a);t(c)}catch{r(new Error(`Failed to parse response: ${a}`))}})});i.on("error",r),i.setTimeout(1e4,()=>{i.destroy(),r(new Error("Request timeout"))})})}httpPost(e,t){return this.httpRequest("POST",e,t)}httpPut(e,t){return this.httpRequest("PUT",e,t)}httpRequest(e,t,r){return new Promise((o,i)=>{let n=JSON.stringify(r),a=`http://${this.serverHost}:${this.serverPort}${t}`;this.log(`${e} ${a}`);let c={hostname:this.serverHost,port:this.serverPort,path:t,method:e,headers:{"Content-Type":"application/json","Content-Length":Buffer.byteLength(n)}},u=Ft.request(c,d=>{let p="";d.on("data",l=>p+=l),d.on("end",()=>{try{if(d.statusCode&&d.statusCode>=400){i(new Error(`HTTP ${d.statusCode}: ${p}`));return}let l=JSON.parse(p);o(l)}catch{i(new Error(`Failed to parse response: ${p}`))}})});u.on("error",i),u.setTimeout(1e4,()=>{u.destroy(),i(new Error("Request timeout"))}),u.write(n),u.end()})}};var Me=q(require("vscode")),Ye=class{participant;mcpBridge;workspaceId=null;constructor(e){this.mcpBridge=e,this.participant=Me.chat.createChatParticipant("project-memory.memory",this.handleRequest.bind(this)),this.participant.iconPath=new Me.ThemeIcon("book"),this.participant.followupProvider={provideFollowups:this.provideFollowups.bind(this)}}async handleRequest(e,t,r,o){if(!this.mcpBridge.isConnected())return r.markdown(`\u26A0\uFE0F **Not connected to MCP server**

Use the "Project Memory: Reconnect Chat to MCP Server" command to reconnect.`),{metadata:{command:"error"}};await this.ensureWorkspaceRegistered(r);try{switch(e.command){case"plan":return await this.handlePlanCommand(e,r,o);case"context":return await this.handleContextCommand(e,r,o);case"handoff":return await this.handleHandoffCommand(e,r,o);case"status":return await this.handleStatusCommand(e,r,o);default:return await this.handleDefaultCommand(e,r,o)}}catch(i){let n=i instanceof Error?i.message:String(i);return r.markdown(`\u274C **Error**: ${n}`),{metadata:{command:"error"}}}}async ensureWorkspaceRegistered(e){if(this.workspaceId)return;let t=Me.workspace.workspaceFolders?.[0];if(!t){e.markdown(`\u26A0\uFE0F No workspace folder open. Please open a folder first.
`);return}if(!this.mcpBridge.isConnected()){e.markdown(`\u26A0\uFE0F MCP server not connected. Click the MCP status bar item to reconnect.
`);return}try{console.log(`Registering workspace: ${t.uri.fsPath}`);let r=await this.mcpBridge.callTool("register_workspace",{workspace_path:t.uri.fsPath});console.log(`Register workspace result: ${JSON.stringify(r)}`),r.workspace?.workspace_id?(this.workspaceId=r.workspace.workspace_id,console.log(`Workspace registered: ${this.workspaceId}`)):(console.error("Unexpected response format:",r),e.markdown(`\u26A0\uFE0F Unexpected response from MCP server. Check console for details.
`))}catch(r){let o=r instanceof Error?r.message:String(r);console.error("Failed to register workspace:",r),e.markdown(`\u26A0\uFE0F Failed to register workspace: ${o}
`)}}async handlePlanCommand(e,t,r){let o=e.prompt.trim();if(!o||o==="list")return await this.listPlans(t);if(o.startsWith("create "))return await this.createPlan(o.substring(7),t);if(o.startsWith("show ")){let i=o.substring(5).trim();return await this.showPlan(i,t)}return t.markdown(`\u{1F4CB} **Plan Commands**

`),t.markdown("- `/plan list` - List all plans in this workspace\n"),t.markdown("- `/plan create <title>` - Create a new plan\n"),t.markdown("- `/plan show <plan-id>` - Show plan details\n"),t.markdown(`
Or just describe what you want to do and I'll help create a plan.`),{metadata:{command:"plan"}}}async listPlans(e){if(!this.workspaceId)return e.markdown("\u26A0\uFE0F Workspace not registered."),{metadata:{command:"plan"}};let r=(await this.mcpBridge.callTool("list_plans",{workspace_id:this.workspaceId})).active_plans||[];if(r.length===0)return e.markdown("\u{1F4CB} **No plans found**\n\nUse `/plan create <title>` to create a new plan."),{metadata:{command:"plan"}};e.markdown(`\u{1F4CB} **Plans in this workspace** (${r.length})

`);for(let o of r){let i=this.getStatusEmoji(o.status);e.markdown(`${i} **${o.title}** \`${o.plan_id}\`
`),o.category&&e.markdown(`   Category: ${o.category}
`)}return{metadata:{command:"plan",plans:r.length}}}async createPlan(e,t){if(!this.workspaceId)return t.markdown("\u26A0\uFE0F Workspace not registered."),{metadata:{command:"plan"}};t.markdown(`\u{1F504} Creating plan: **${e}**...

`);let r=await this.mcpBridge.callTool("create_plan",{workspace_id:this.workspaceId,title:e,description:e,category:"feature"});return t.markdown(`\u2705 **Plan created!**

`),t.markdown(`- **ID**: \`${r.plan_id}\`
`),t.markdown(`- **Title**: ${r.title}
`),t.markdown(`
Use \`/plan show ${r.plan_id}\` to see details.`),{metadata:{command:"plan",action:"created",planId:r.plan_id}}}async showPlan(e,t){if(!this.workspaceId)return t.markdown("\u26A0\uFE0F Workspace not registered."),{metadata:{command:"plan"}};let r=await this.mcpBridge.callTool("get_plan_state",{workspace_id:this.workspaceId,plan_id:e});if(t.markdown(`# \u{1F4CB} ${r.title}

`),t.markdown(`**ID**: \`${r.plan_id}\`
`),r.category&&t.markdown(`**Category**: ${r.category}
`),r.priority&&t.markdown(`**Priority**: ${r.priority}
`),r.description&&t.markdown(`
${r.description}
`),r.steps&&r.steps.length>0){t.markdown(`
## Steps

`);for(let o=0;o<r.steps.length;o++){let i=r.steps[o],n=this.getStepStatusEmoji(i.status);t.markdown(`${n} **${i.phase}**: ${i.task}
`)}}if(r.lineage&&r.lineage.length>0){t.markdown(`
## Agent History

`);for(let o of r.lineage)t.markdown(`- **${o.agent_type}** (${o.started_at})
`),o.summary&&t.markdown(`  ${o.summary}
`)}return{metadata:{command:"plan",action:"show",planId:e}}}async handleContextCommand(e,t,r){if(!this.workspaceId)return t.markdown("\u26A0\uFE0F Workspace not registered."),{metadata:{command:"context"}};t.markdown(`\u{1F50D} **Gathering workspace context...**

`);try{let o=await this.mcpBridge.callTool("get_workspace_info",{workspace_id:this.workspaceId});if(t.markdown(`## Workspace Information

`),t.markdown(`**ID**: \`${o.workspace_id}\`
`),t.markdown(`**Path**: \`${o.workspace_path}\`
`),o.codebase_profile){let i=o.codebase_profile;t.markdown(`
## Codebase Profile

`),i.languages&&i.languages.length>0&&t.markdown(`**Languages**: ${i.languages.join(", ")}
`),i.frameworks&&i.frameworks.length>0&&t.markdown(`**Frameworks**: ${i.frameworks.join(", ")}
`),i.file_count&&t.markdown(`**Files**: ${i.file_count}
`)}}catch{t.markdown(`\u26A0\uFE0F Could not retrieve full context. Basic workspace info:

`),t.markdown(`**Workspace ID**: \`${this.workspaceId}\`
`)}return{metadata:{command:"context"}}}async handleHandoffCommand(e,t,r){let o=e.prompt.trim();if(!o)return t.markdown(`\u{1F91D} **Handoff Command**

`),t.markdown("Usage: `/handoff <agent-type> <plan-id> [summary]`\n\n"),t.markdown(`**Available agents:**
`),t.markdown("- `Coordinator` - Orchestrates the workflow\n"),t.markdown("- `Researcher` - Gathers external information\n"),t.markdown("- `Architect` - Creates implementation plans\n"),t.markdown("- `Executor` - Implements the plan\n"),t.markdown("- `Reviewer` - Validates completed work\n"),t.markdown("- `Tester` - Writes and runs tests\n"),t.markdown("- `Archivist` - Finalizes and archives\n"),{metadata:{command:"handoff"}};let i=o.split(" ");if(i.length<2)return t.markdown(`\u26A0\uFE0F Please provide both agent type and plan ID.
`),t.markdown("Example: `/handoff Executor plan_abc123`"),{metadata:{command:"handoff"}};let n=i[0],a=i[1],c=i.slice(2).join(" ")||"Handoff from chat";if(!this.workspaceId)return t.markdown("\u26A0\uFE0F Workspace not registered."),{metadata:{command:"handoff"}};t.markdown(`\u{1F504} Initiating handoff to **${n}**...

`);try{await this.mcpBridge.callTool("handoff",{workspace_id:this.workspaceId,plan_id:a,target_agent:n,summary:c}),t.markdown(`\u2705 **Handoff complete!**

`),t.markdown(`Plan \`${a}\` has been handed off to **${n}**.
`),t.markdown("The agent file should be invoked to continue work.")}catch(u){let d=u instanceof Error?u.message:String(u);t.markdown(`\u274C Handoff failed: ${d}`)}return{metadata:{command:"handoff",targetAgent:n,planId:a}}}async handleStatusCommand(e,t,r){if(!this.workspaceId)return t.markdown("\u26A0\uFE0F Workspace not registered."),{metadata:{command:"status"}};t.markdown(`\u{1F4CA} **Project Memory Status**

`);let o=this.mcpBridge.isConnected();t.markdown(`**MCP Server**: ${o?"\u{1F7E2} Connected":"\u{1F534} Disconnected"}
`),t.markdown(`**Workspace ID**: \`${this.workspaceId}\`

`);try{let a=((await this.mcpBridge.callTool("list_plans",{workspace_id:this.workspaceId})).active_plans||[]).filter(c=>c.status!=="archived");if(t.markdown(`## Active Plans (${a.length})

`),a.length===0)t.markdown(`No active plans.
`);else for(let c of a){let u=this.getStatusEmoji(c.status),d=c.done_steps||0,p=c.total_steps||0;t.markdown(`${u} **${c.title}**
`),p>0&&t.markdown(`   Progress: ${d}/${p} steps
`)}}catch{t.markdown(`Could not retrieve plan status.
`)}return{metadata:{command:"status"}}}async handleDefaultCommand(e,t,r){let o=e.prompt.trim();if(!o)return t.markdown(`\u{1F44B} **Welcome to Project Memory!**

`),t.markdown(`I can help you manage project plans and agent workflows.

`),t.markdown(`**Available commands:**
`),t.markdown("- `/plan` - View, create, or manage plans\n"),t.markdown("- `/context` - Get workspace context and codebase profile\n"),t.markdown("- `/handoff` - Execute agent handoffs\n"),t.markdown("- `/status` - Show current plan progress\n"),t.markdown(`
Or just ask me about your project!`),{metadata:{command:"help"}};if(o.toLowerCase().includes("plan")||o.toLowerCase().includes("create"))t.markdown(`I can help you with plans!

`),t.markdown("Try using the `/plan` command:\n"),t.markdown("- `/plan list` to see existing plans\n"),t.markdown(`- \`/plan create ${o}\` to create a new plan
`);else{if(o.toLowerCase().includes("status")||o.toLowerCase().includes("progress"))return await this.handleStatusCommand(e,t,r);t.markdown(`I understand you want to: **${o}**

`),t.markdown(`Here's what I can help with:
`),t.markdown(`- Use \`/plan create ${o}\` to create a plan for this
`),t.markdown("- Use `/status` to check current progress\n"),t.markdown("- Use `/context` to get workspace information\n")}return{metadata:{command:"default"}}}provideFollowups(e,t,r){let o=e.metadata,i=o?.command,n=[];switch(i){case"plan":o?.action==="created"&&o?.planId&&n.push({prompt:`/plan show ${o.planId}`,label:"View plan details",command:"plan"}),n.push({prompt:"/status",label:"Check status",command:"status"});break;case"status":n.push({prompt:"/plan list",label:"List all plans",command:"plan"});break;case"help":case"default":n.push({prompt:"/plan list",label:"List plans",command:"plan"}),n.push({prompt:"/status",label:"Check status",command:"status"});break}return n}getStatusEmoji(e){switch(e){case"active":return"\u{1F535}";case"completed":return"\u2705";case"archived":return"\u{1F4E6}";case"blocked":return"\u{1F534}";default:return"\u26AA"}}getStepStatusEmoji(e){switch(e){case"done":return"\u2705";case"active":return"\u{1F504}";case"blocked":return"\u{1F534}";default:return"\u2B1C"}}resetWorkspace(){this.workspaceId=null}dispose(){this.participant.dispose()}};var ee=q(require("vscode")),Qe=class{mcpBridge;workspaceId=null;disposables=[];constructor(e){this.mcpBridge=e,this.registerTools()}registerTools(){this.disposables.push(ee.lm.registerTool("memory_plan",{invoke:async(e,t)=>await this.handlePlan(e,t)})),this.disposables.push(ee.lm.registerTool("memory_steps",{invoke:async(e,t)=>await this.handleSteps(e,t)})),this.disposables.push(ee.lm.registerTool("memory_context",{invoke:async(e,t)=>await this.handleContext(e,t)}))}async ensureWorkspace(){if(this.workspaceId)return this.workspaceId;let e=ee.workspace.workspaceFolders?.[0];if(!e)throw new Error("No workspace folder open");let t=await this.mcpBridge.callTool("memory_workspace",{action:"register",workspace_path:e.uri.fsPath});return this.workspaceId=t.workspace_id,this.workspaceId}async handlePlan(e,t){try{if(!this.mcpBridge.isConnected())return this.errorResult("MCP server not connected");let r=await this.ensureWorkspace(),{action:o,planId:i,title:n,description:a,category:c,priority:u,includeArchived:d}=e.input,p;switch(o){case"list":let l=await this.mcpBridge.callTool("memory_plan",{action:"list",workspace_id:r,include_archived:d});p={workspace_id:r,plans:l.active_plans||[],total:(l.active_plans||[]).length,message:(l.active_plans||[]).length>0?`Found ${(l.active_plans||[]).length} plan(s)`:'No plans found. Use action "create" to create one.'};break;case"get":if(!i)return this.errorResult("planId is required for get action");p=await this.mcpBridge.callTool("memory_plan",{action:"get",workspace_id:r,plan_id:i});break;case"create":if(!n||!a)return this.errorResult("title and description are required for create action");p=await this.mcpBridge.callTool("memory_plan",{action:"create",workspace_id:r,title:n,description:a,category:c||"feature",priority:u||"medium"});break;case"archive":if(!i)return this.errorResult("planId is required for archive action");p=await this.mcpBridge.callTool("memory_plan",{action:"archive",workspace_id:r,plan_id:i});break;default:return this.errorResult(`Unknown action: ${o}`)}return new ee.LanguageModelToolResult([new ee.LanguageModelTextPart(JSON.stringify(p,null,2))])}catch(r){return this.errorResult(r)}}async handleSteps(e,t){try{if(!this.mcpBridge.isConnected())return this.errorResult("MCP server not connected");let r=await this.ensureWorkspace(),{action:o,planId:i,stepIndex:n,status:a,notes:c,updates:u,newSteps:d}=e.input;if(!i)return this.errorResult("planId is required");let p;switch(o){case"update":if(n===void 0||!a)return this.errorResult("stepIndex and status are required for update action");p=await this.mcpBridge.callTool("memory_steps",{action:"update",workspace_id:r,plan_id:i,step_index:n,status:a,notes:c});break;case"batch_update":if(!u||u.length===0)return this.errorResult("updates array is required for batch_update action");p=await this.mcpBridge.callTool("memory_steps",{action:"batch_update",workspace_id:r,plan_id:i,updates:u});break;case"add":if(!d||d.length===0)return this.errorResult("newSteps array is required for add action");p=await this.mcpBridge.callTool("memory_steps",{action:"add",workspace_id:r,plan_id:i,steps:d.map(l=>({...l,status:l.status||"pending"}))});break;default:return this.errorResult(`Unknown action: ${o}`)}return new ee.LanguageModelToolResult([new ee.LanguageModelTextPart(JSON.stringify(p,null,2))])}catch(r){return this.errorResult(r)}}async handleContext(e,t){try{if(!this.mcpBridge.isConnected())return this.errorResult("MCP server not connected");let r=await this.ensureWorkspace(),{action:o,planId:i,note:n,noteType:a,targetAgent:c,reason:u}=e.input,d;switch(o){case"add_note":if(!i||!n)return this.errorResult("planId and note are required for add_note action");d=await this.mcpBridge.callTool("memory_plan",{action:"add_note",workspace_id:r,plan_id:i,note:n,note_type:a||"info"});break;case"briefing":if(!i)return this.errorResult("planId is required for briefing action");d=await this.mcpBridge.callTool("memory_agent",{action:"get_briefing",workspace_id:r,plan_id:i});break;case"handoff":if(!i||!c||!u)return this.errorResult("planId, targetAgent, and reason are required for handoff action");d=await this.mcpBridge.callTool("memory_agent",{action:"handoff",workspace_id:r,plan_id:i,to_agent:c,reason:u});break;case"workspace":d=await this.mcpBridge.callTool("memory_workspace",{action:"info",workspace_id:r});break;default:return this.errorResult(`Unknown action: ${o}`)}return new ee.LanguageModelToolResult([new ee.LanguageModelTextPart(JSON.stringify(d,null,2))])}catch(r){return this.errorResult(r)}}errorResult(e){let t=e instanceof Error?e.message:String(e);return new ee.LanguageModelToolResult([new ee.LanguageModelTextPart(JSON.stringify({success:!1,error:t}))])}dispose(){this.disposables.forEach(e=>e.dispose()),this.disposables=[]}};var ue,Je,De,Ns,B,Xe,ce=null,Ce=null,Ee=null;function U(s,...e){return h.workspace.getConfiguration("projectMemory").get("showNotifications",!0)?h.window.showInformationMessage(s,...e):Promise.resolve(void 0)}function fc(s){console.log("Project Memory Dashboard extension activating...");let e=h.workspace.getConfiguration("projectMemory"),t=e.get("dataRoot")||Go(),r=e.get("agentsRoot")||Ze(),o=e.get("promptsRoot"),i=e.get("instructionsRoot"),n=e.get("serverPort")||3001,a=e.get("wsPort")||3002,c=e.get("autoStartServer")??!0,u=e.get("defaultAgents")||[],d=e.get("defaultInstructions")||[],p=e.get("autoDeployOnWorkspaceOpen")??!1;if(Xe=new Mt({agentsRoot:r,instructionsRoot:i||Lt(),defaultAgents:u,defaultInstructions:d}),p&&h.workspace.workspaceFolders?.[0]){let l=h.workspace.workspaceFolders[0].uri.fsPath;Xe.deployToWorkspace(l).then(f=>{(f.agents.length>0||f.instructions.length>0)&&U(`Deployed ${f.agents.length} agents and ${f.instructions.length} instructions`)})}B=new $t({dataRoot:t,agentsRoot:r,promptsRoot:o,instructionsRoot:i,serverPort:n,wsPort:a}),s.subscriptions.push(B),c&&B.hasServerDirectory()&&B.start().then(async l=>{l?B.isExternalServer?U("Connected to existing Project Memory server"):U("Project Memory API server started"):h.window.showWarningMessage("Failed to start Project Memory server. Click to view logs.","View Logs").then(f=>{f==="View Logs"&&B.showLogs()})}),mc(s,e,t),ue=new nt(s.extensionUri,t,r),s.subscriptions.push(h.window.registerWebviewViewProvider("projectMemory.dashboardView",ue,{webviewOptions:{retainContextWhenHidden:!0}})),s.subscriptions.push(h.commands.registerCommand("projectMemory.showDashboard",()=>{h.commands.executeCommand("workbench.view.extension.projectMemory")}),h.commands.registerCommand("projectMemory.openDashboardPanel",async l=>{if(!B.isRunning){if(await h.window.showWarningMessage("Project Memory server is not running. Start it first?","Start Server","Cancel")!=="Start Server")return;if(!await h.window.withProgress({location:h.ProgressLocation.Notification,title:"Starting Project Memory server...",cancellable:!1},async()=>await B.start())){h.window.showErrorMessage("Failed to start server. Check logs for details."),B.showLogs();return}}if(!B.isFrontendRunning&&!await h.window.withProgress({location:h.ProgressLocation.Notification,title:"Starting dashboard frontend...",cancellable:!1},async()=>await B.startFrontend())){h.window.showErrorMessage("Failed to start dashboard frontend. Check server logs."),B.showLogs();return}let f=l||"http://localhost:5173";Dt.createOrShow(s.extensionUri,f)}),h.commands.registerCommand("projectMemory.toggleServer",async()=>{B.isRunning?(await B.stopFrontend(),await B.stop(),U("Project Memory server stopped")):await B.start()?U("Project Memory server started"):h.window.showErrorMessage("Failed to start Project Memory server")}),h.commands.registerCommand("projectMemory.startServer",async()=>{if(B.isRunning){U("Server is already running");return}await B.start()?U("Project Memory server started"):(h.window.showErrorMessage("Failed to start server. Check logs for details."),B.showLogs())}),h.commands.registerCommand("projectMemory.stopServer",async()=>{await B.stopFrontend(),await B.stop(),U("Project Memory server stopped")}),h.commands.registerCommand("projectMemory.restartServer",async()=>{U("Restarting Project Memory server..."),await B.stopFrontend(),await B.restart()?U("Project Memory server restarted"):h.window.showErrorMessage("Failed to restart server")}),h.commands.registerCommand("projectMemory.showServerLogs",()=>{B.showLogs()}),h.commands.registerCommand("projectMemory.openSettings",async()=>{let l=h.workspace.getConfiguration("projectMemory"),f=l.get("agentsRoot")||Ze(),v=l.get("instructionsRoot")||Lt(),y=l.get("promptsRoot")||qo(),R=await h.window.showQuickPick([{label:"$(person) Configure Default Agents",description:"Select which agents to deploy by default",value:"agents"},{label:"$(book) Configure Default Instructions",description:"Select which instructions to deploy by default",value:"instructions"},{label:"$(file) Configure Default Prompts",description:"Select which prompts to deploy by default",value:"prompts"},{label:"$(gear) Open All Settings",description:"Open VS Code settings for Project Memory",value:"settings"}],{placeHolder:"What would you like to configure?"});if(!R)return;let P=require("fs");if(R.value==="settings"){h.commands.executeCommand("workbench.action.openSettings","@ext:project-memory.project-memory-dashboard");return}if(R.value==="agents"&&f)try{let S=P.readdirSync(f).filter(C=>C.endsWith(".agent.md")).map(C=>C.replace(".agent.md","")),E=l.get("defaultAgents")||[],F=S.map(C=>({label:C,picked:E.length===0||E.includes(C)})),T=await h.window.showQuickPick(F,{canPickMany:!0,placeHolder:"Select default agents (these will be pre-selected when deploying)",title:"Configure Default Agents"});T&&(await l.update("defaultAgents",T.map(C=>C.label),h.ConfigurationTarget.Global),U(`\u2705 Updated default agents (${T.length} selected)`))}catch(S){h.window.showErrorMessage(`Failed to read agents: ${S}`)}if(R.value==="instructions"&&v)try{let S=P.readdirSync(v).filter(C=>C.endsWith(".instructions.md")).map(C=>C.replace(".instructions.md","")),E=l.get("defaultInstructions")||[],F=S.map(C=>({label:C,picked:E.length===0||E.includes(C)})),T=await h.window.showQuickPick(F,{canPickMany:!0,placeHolder:"Select default instructions (these will be pre-selected when deploying)",title:"Configure Default Instructions"});T&&(await l.update("defaultInstructions",T.map(C=>C.label),h.ConfigurationTarget.Global),U(`\u2705 Updated default instructions (${T.length} selected)`))}catch(S){h.window.showErrorMessage(`Failed to read instructions: ${S}`)}if(R.value==="prompts"&&y)try{let S=P.readdirSync(y).filter(C=>C.endsWith(".prompt.md")).map(C=>C.replace(".prompt.md","")),E=l.get("defaultPrompts")||[],F=S.map(C=>({label:C,picked:E.length===0||E.includes(C)})),T=await h.window.showQuickPick(F,{canPickMany:!0,placeHolder:"Select default prompts (these will be pre-selected when deploying)",title:"Configure Default Prompts"});T&&(await l.update("defaultPrompts",T.map(C=>C.label),h.ConfigurationTarget.Global),U(`\u2705 Updated default prompts (${T.length} selected)`))}catch(S){h.window.showErrorMessage(`Failed to read prompts: ${S}`)}}),h.commands.registerCommand("projectMemory.createPlan",async()=>{let l=h.workspace.workspaceFolders;if(!l){h.window.showErrorMessage("No workspace folder open");return}let f=await h.window.showQuickPick([{label:"\u{1F9E0} Brainstorm First",description:"Explore ideas with an AI agent before creating a formal plan",value:"brainstorm"},{label:"\u{1F4DD} Create Plan Directly",description:"Create a formal plan with title, description, and category",value:"create"}],{placeHolder:"How would you like to start?"});if(!f)return;if(f.value==="brainstorm"){let C=await h.window.showInputBox({prompt:"What would you like to brainstorm?",placeHolder:"Describe the feature, problem, or idea you want to explore...",validateInput:D=>D.trim()?null:"Please enter a description"});if(!C)return;try{await h.commands.executeCommand("workbench.action.chat.open",{query:`@brainstorm ${C}`})}catch{await h.window.showInformationMessage("Open GitHub Copilot Chat and use @brainstorm agent with your prompt.","Copy Prompt")==="Copy Prompt"&&(await h.env.clipboard.writeText(`@brainstorm ${C}`),U("Prompt copied to clipboard"))}return}let v=await h.window.showInputBox({prompt:"Enter plan title",placeHolder:"My new feature...",validateInput:C=>C.trim()?null:"Title is required"});if(!v)return;let y=await h.window.showInputBox({prompt:"Enter plan description",placeHolder:"Describe what this plan will accomplish, the goals, and any context...",validateInput:C=>C.trim().length>=10?null:"Please provide at least a brief description (10+ characters)"});if(!y)return;let R=await h.window.showQuickPick([{label:"\u2728 Feature",description:"New functionality or capability",value:"feature"},{label:"\u{1F41B} Bug",description:"Fix for an existing issue",value:"bug"},{label:"\u{1F504} Change",description:"Modification to existing behavior",value:"change"},{label:"\u{1F50D} Analysis",description:"Investigation or research task",value:"analysis"},{label:"\u{1F41E} Debug",description:"Debugging session for an issue",value:"debug"},{label:"\u267B\uFE0F Refactor",description:"Code improvement without behavior change",value:"refactor"},{label:"\u{1F4DA} Documentation",description:"Documentation updates",value:"documentation"}],{placeHolder:"Select plan category"});if(!R)return;let P=await h.window.showQuickPick([{label:"\u{1F534} Critical",description:"Urgent - needs immediate attention",value:"critical"},{label:"\u{1F7E0} High",description:"Important - should be done soon",value:"high"},{label:"\u{1F7E1} Medium",description:"Normal priority",value:"medium"},{label:"\u{1F7E2} Low",description:"Nice to have - when time permits",value:"low"}],{placeHolder:"Select priority level"});if(!P)return;let S=l[0].uri.fsPath,E=require("path").basename(S).toLowerCase().replace(/[^a-z0-9]/g,"_").substring(0,20),F=require("crypto").createHash("md5").update(S).digest("hex").substring(0,12),T=`${E}-${F}`;try{let C=await fetch(`http://localhost:${n}/api/plans`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({workspaceId:T,title:v,description:y,category:R.value,priority:P.value})});if(C.ok){let D=await C.json();U(`Plan created: ${v}`,"Open Dashboard").then(b=>{b==="Open Dashboard"&&h.commands.executeCommand("projectMemory.openDashboardPanel",`http://localhost:5173/workspace/${T}/plan/${D.planId}`)})}else{let D=await C.text();h.window.showErrorMessage(`Failed to create plan: ${D}`)}}catch(C){h.window.showErrorMessage(`Failed to create plan: ${C}`)}}),h.commands.registerCommand("projectMemory.deployAgents",async()=>{let l=h.workspace.workspaceFolders;if(!l){h.window.showErrorMessage("No workspace folder open");return}let f=h.workspace.getConfiguration("projectMemory"),v=f.get("agentsRoot")||Ze(),y=f.get("instructionsRoot")||Lt(),R=f.get("defaultAgents")||[],P=f.get("defaultInstructions")||[];if(!v){h.window.showErrorMessage("Agents root not configured. Set projectMemory.agentsRoot in settings.");return}let S=l[0].uri.fsPath,E=require("fs"),F=require("path");try{let T=E.readdirSync(v).filter($=>$.endsWith(".agent.md"));if(T.length===0){h.window.showWarningMessage("No agent files found in agents root");return}let C=T.map($=>{let L=$.replace(".agent.md","");return{label:L,description:$,picked:R.length===0||R.includes(L)}}),D=await h.window.showQuickPick(C,{canPickMany:!0,placeHolder:"Select agents to deploy",title:"Deploy Agents"});if(!D||D.length===0)return;let b=F.join(S,".github","agents");E.mkdirSync(b,{recursive:!0});let A=0;for(let $ of D){let L=`${$.label}.agent.md`,oe=F.join(v,L),g=F.join(b,L);E.copyFileSync(oe,g),A++}let j=0;if(y&&P.length>0){let $=F.join(S,".github","instructions");E.mkdirSync($,{recursive:!0});for(let L of P){let oe=`${L}.instructions.md`,g=F.join(y,oe),m=F.join($,oe);E.existsSync(g)&&(E.copyFileSync(g,m),j++)}}ue.postMessage({type:"deploymentComplete",data:{type:"agents",count:A,instructionsCount:j,targetDir:b}});let w=j>0?`\u2705 Deployed ${A} agent(s) and ${j} instruction(s)`:`\u2705 Deployed ${A} agent(s)`;U(w,"Open Folder").then($=>{$==="Open Folder"&&h.commands.executeCommand("revealInExplorer",h.Uri.file(b))})}catch(T){h.window.showErrorMessage(`Failed to deploy agents: ${T}`)}}),h.commands.registerCommand("projectMemory.deployPrompts",async()=>{let l=h.workspace.workspaceFolders;if(!l){h.window.showErrorMessage("No workspace folder open");return}let f=h.workspace.getConfiguration("projectMemory"),v=f.get("promptsRoot")||qo(),y=f.get("defaultPrompts")||[];if(!v){h.window.showErrorMessage("Prompts root not configured. Set projectMemory.promptsRoot in settings.");return}let R=l[0].uri.fsPath,P=require("fs"),S=require("path");try{let E=P.readdirSync(v).filter(b=>b.endsWith(".prompt.md"));if(E.length===0){h.window.showWarningMessage("No prompt files found in prompts root");return}let F=E.map(b=>{let A=b.replace(".prompt.md","");return{label:A,description:b,picked:y.length===0||y.includes(A)}}),T=await h.window.showQuickPick(F,{canPickMany:!0,placeHolder:"Select prompts to deploy",title:"Deploy Prompts"});if(!T||T.length===0)return;let C=S.join(R,".github","prompts");P.mkdirSync(C,{recursive:!0});let D=0;for(let b of T){let A=`${b.label}.prompt.md`,j=S.join(v,A),w=S.join(C,A);P.copyFileSync(j,w),D++}ue.postMessage({type:"deploymentComplete",data:{type:"prompts",count:D,targetDir:C}}),U(`\u2705 Deployed ${D} prompt(s) to ${S.relative(R,C)}`,"Open Folder").then(b=>{b==="Open Folder"&&h.commands.executeCommand("revealInExplorer",h.Uri.file(C))})}catch(E){h.window.showErrorMessage(`Failed to deploy prompts: ${E}`)}}),h.commands.registerCommand("projectMemory.deployInstructions",async()=>{let l=h.workspace.workspaceFolders;if(!l){h.window.showErrorMessage("No workspace folder open");return}let f=h.workspace.getConfiguration("projectMemory"),v=f.get("instructionsRoot")||Lt(),y=f.get("defaultInstructions")||[];if(!v){h.window.showErrorMessage("Instructions root not configured. Set projectMemory.instructionsRoot in settings.");return}let R=l[0].uri.fsPath,P=require("fs"),S=require("path");try{let E=P.readdirSync(v).filter(b=>b.endsWith(".instructions.md"));if(E.length===0){h.window.showWarningMessage("No instruction files found in instructions root");return}let F=E.map(b=>{let A=b.replace(".instructions.md","");return{label:A,description:b,picked:y.length===0||y.includes(A)}}),T=await h.window.showQuickPick(F,{canPickMany:!0,placeHolder:"Select instructions to deploy",title:"Deploy Instructions"});if(!T||T.length===0)return;let C=S.join(R,".github","instructions");P.mkdirSync(C,{recursive:!0});let D=0;for(let b of T){let A=`${b.label}.instructions.md`,j=S.join(v,A),w=S.join(C,A);P.copyFileSync(j,w),D++}ue.postMessage({type:"deploymentComplete",data:{type:"instructions",count:D,targetDir:C}}),U(`\u2705 Deployed ${D} instruction(s) to ${S.relative(R,C)}`,"Open Folder").then(b=>{b==="Open Folder"&&h.commands.executeCommand("revealInExplorer",h.Uri.file(C))})}catch(E){h.window.showErrorMessage(`Failed to deploy instructions: ${E}`)}}),h.commands.registerCommand("projectMemory.deployCopilotConfig",async()=>{let l=h.workspace.workspaceFolders;if(!l){h.window.showErrorMessage("No workspace folder open");return}await h.window.showQuickPick(["Yes","No"],{placeHolder:"Deploy all Copilot config (agents, prompts, instructions)?"})==="Yes"&&(ue.postMessage({type:"deployAllCopilotConfig",data:{workspacePath:l[0].uri.fsPath}}),U("Deploying all Copilot configuration..."))}),h.commands.registerCommand("projectMemory.deployDefaults",async()=>{let l=h.workspace.workspaceFolders;if(!l){h.window.showErrorMessage("No workspace folder open");return}let f=Xe.getDeploymentPlan();if(await h.window.showQuickPick(["Yes","No"],{placeHolder:`Deploy ${f.agents.length} agents and ${f.instructions.length} instructions?`})==="Yes"){let y=await Xe.deployToWorkspace(l[0].uri.fsPath);U(`Deployed ${y.agents.length} agents and ${y.instructions.length} instructions`)}}),h.commands.registerCommand("projectMemory.updateDefaults",async()=>{let l=h.workspace.workspaceFolders;if(!l){h.window.showErrorMessage("No workspace folder open");return}let f=await Xe.updateWorkspace(l[0].uri.fsPath);f.updated.length>0||f.added.length>0?U(`Updated ${f.updated.length} files, added ${f.added.length} new files`):U("All files are up to date")}),h.commands.registerCommand("projectMemory.openAgentFile",async()=>{let f=h.workspace.getConfiguration("projectMemory").get("agentsRoot")||Ze();if(!f){h.window.showErrorMessage("Agents root not configured");return}let v=require("fs"),y=require("path");try{let R=v.readdirSync(f).filter(S=>S.endsWith(".agent.md")),P=await h.window.showQuickPick(R,{placeHolder:"Select an agent file to open"});if(P){let S=y.join(f,P),E=await h.workspace.openTextDocument(S);await h.window.showTextDocument(E)}}catch(R){h.window.showErrorMessage(`Failed to list agent files: ${R}`)}}),h.commands.registerCommand("projectMemory.openPromptFile",async()=>{let f=h.workspace.getConfiguration("projectMemory").get("promptsRoot");if(!f){h.window.showErrorMessage("Prompts root not configured. Set projectMemory.promptsRoot in settings.");return}let v=require("fs"),y=require("path");try{let R=v.readdirSync(f).filter(S=>S.endsWith(".prompt.md")),P=await h.window.showQuickPick(R,{placeHolder:"Select a prompt file to open"});if(P){let S=y.join(f,P),E=await h.workspace.openTextDocument(S);await h.window.showTextDocument(E)}}catch(R){h.window.showErrorMessage(`Failed to list prompt files: ${R}`)}}),h.commands.registerCommand("projectMemory.showCopilotStatus",()=>{ue.postMessage({type:"showCopilotStatus"}),h.commands.executeCommand("workbench.view.extension.projectMemory")}),h.commands.registerCommand("projectMemory.refreshData",()=>{ue.postMessage({type:"refresh"})}),h.commands.registerCommand("projectMemory.openFile",async(l,f)=>{try{let v=await h.workspace.openTextDocument(l),y=await h.window.showTextDocument(v);if(f!==void 0){let R=new h.Position(f-1,0);y.selection=new h.Selection(R,R),y.revealRange(new h.Range(R,R),h.TextEditorRevealType.InCenter)}}catch{h.window.showErrorMessage(`Failed to open file: ${l}`)}}),h.commands.registerCommand("projectMemory.addToPlan",async l=>{let f,v,y;if(l)f=l.fsPath;else{let E=h.window.activeTextEditor;if(E){f=E.document.uri.fsPath;let F=E.selection;F.isEmpty||(v=E.document.getText(F),y=F.start.line+1)}}if(!f){h.window.showErrorMessage("No file selected");return}if(!h.workspace.workspaceFolders){h.window.showErrorMessage("No workspace folder open");return}let P=await h.window.showInputBox({prompt:"Describe the step/task for this file",placeHolder:"e.g., Review and update authentication logic",value:v?`Review: ${v.substring(0,50)}...`:`Work on ${require("path").basename(f)}`});if(!P)return;let S=await h.window.showQuickPick(["implementation","review","testing","documentation","refactor","bugfix"],{placeHolder:"Select the phase for this step"});S&&(ue.postMessage({type:"addStepToPlan",data:{task:P,phase:S,file:f,line:y,notes:v?`Selected code:
\`\`\`
${v.substring(0,500)}
\`\`\``:void 0}}),U(`Added step to plan: "${P}"`))})),r&&(Je=new St(r,e.get("autoDeployAgents")||!1),Je.start(),s.subscriptions.push({dispose:()=>Je.stop()})),De=new Pt({agentsRoot:r,promptsRoot:o,instructionsRoot:i,autoDeploy:e.get("autoDeployAgents")||!1}),De.start(),De.onFileChanged((l,f,v)=>{v==="change"&&Ns.showTemporaryMessage(`${l} updated`)}),s.subscriptions.push({dispose:()=>De.stop()}),Ns=new Tt,s.subscriptions.push(Ns),s.subscriptions.push(h.workspace.onDidChangeConfiguration(l=>{if(l.affectsConfiguration("projectMemory")){let f=h.workspace.getConfiguration("projectMemory");ue.updateConfig(f.get("dataRoot")||Go(),f.get("agentsRoot")||Ze())}})),console.log("Project Memory Dashboard extension activated")}async function gc(){console.log("Project Memory Dashboard extension deactivating..."),ce&&(await ce.disconnect(),ce.dispose(),ce=null),Ce&&(Ce.dispose(),Ce=null),Ee&&(Ee.dispose(),Ee=null),ue&&ue.dispose(),Je&&Je.stop(),De&&De.stop(),B&&(await B.stopFrontend(),await B.stop()),console.log("Project Memory Dashboard extension deactivated")}function Go(){let s=h.workspace.workspaceFolders;return s?h.Uri.joinPath(s[0].uri,"data").fsPath:""}function Ze(){let s=h.workspace.workspaceFolders;return s?h.Uri.joinPath(s[0].uri,"agents").fsPath:""}function Lt(){let s=h.workspace.workspaceFolders;return s?h.Uri.joinPath(s[0].uri,"instructions").fsPath:""}function qo(){let s=h.workspace.workspaceFolders;return s?h.Uri.joinPath(s[0].uri,"prompts").fsPath:""}function mc(s,e,t){let r=e.get("chat.serverMode")||"bundled",o=e.get("chat.podmanImage")||"project-memory-mcp:latest",i=e.get("chat.externalServerPath")||"",n=e.get("chat.autoConnect")??!0;ce=new Ve({serverMode:r,podmanImage:o,externalServerPath:i,dataRoot:t}),s.subscriptions.push(ce),ce.onConnectionChange(a=>{a&&(Ce?.resetWorkspace(),Ee?.resetWorkspace())}),Ce=new Ye(ce),s.subscriptions.push(Ce),Ee=new Qe(ce),s.subscriptions.push(Ee),s.subscriptions.push(h.commands.registerCommand("projectMemory.chat.reconnect",async()=>{if(!ce){h.window.showErrorMessage("MCP Bridge not initialized");return}try{await h.window.withProgress({location:h.ProgressLocation.Notification,title:"Reconnecting to MCP server...",cancellable:!1},async()=>{await ce.reconnect()}),U("Connected to MCP server")}catch(a){let c=a instanceof Error?a.message:String(a);h.window.showErrorMessage(`Failed to connect: ${c}`),ce.showLogs()}})),n&&ce.connect().then(()=>{console.log("MCP Bridge connected")}).catch(a=>{console.warn("MCP Bridge auto-connect failed:",a)}),s.subscriptions.push(h.workspace.onDidChangeConfiguration(a=>{a.affectsConfiguration("projectMemory.chat")&&U("Chat configuration changed. Some changes may require reconnecting.","Reconnect").then(c=>{c==="Reconnect"&&h.commands.executeCommand("projectMemory.chat.reconnect")})})),s.subscriptions.push(h.workspace.onDidChangeWorkspaceFolders(()=>{Ce?.resetWorkspace(),Ee?.resetWorkspace()})),console.log("Chat integration initialized")}0&&(module.exports={activate,deactivate});
/*! Bundled license information:

normalize-path/index.js:
  (*!
   * normalize-path <https://github.com/jonschlinkert/normalize-path>
   *
   * Copyright (c) 2014-2018, Jon Schlinkert.
   * Released under the MIT License.
   *)

is-extglob/index.js:
  (*!
   * is-extglob <https://github.com/jonschlinkert/is-extglob>
   *
   * Copyright (c) 2014-2016, Jon Schlinkert.
   * Licensed under the MIT License.
   *)

is-glob/index.js:
  (*!
   * is-glob <https://github.com/jonschlinkert/is-glob>
   *
   * Copyright (c) 2014-2017, Jon Schlinkert.
   * Released under the MIT License.
   *)

is-number/index.js:
  (*!
   * is-number <https://github.com/jonschlinkert/is-number>
   *
   * Copyright (c) 2014-present, Jon Schlinkert.
   * Released under the MIT License.
   *)

to-regex-range/index.js:
  (*!
   * to-regex-range <https://github.com/micromatch/to-regex-range>
   *
   * Copyright (c) 2015-present, Jon Schlinkert.
   * Released under the MIT License.
   *)

fill-range/index.js:
  (*!
   * fill-range <https://github.com/jonschlinkert/fill-range>
   *
   * Copyright (c) 2014-present, Jon Schlinkert.
   * Licensed under the MIT License.
   *)
*/
